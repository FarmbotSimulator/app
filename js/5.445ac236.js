(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{0:function(e,t){},"007b":function(e,t,i){"use strict";i.r(t);class s{constructor(){}_destroy(){this.self.enableExternalControls=!1}}t["default"]=s},"02ed":function(e,t,i){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},"1d4c":function(e,t,i){"use strict";i("7db8")},"3b13":function(e){e.exports=JSON.parse('{"Agriculture":"Farm work","Construction":"Farm work","Manufacturing":"Farm work"}')},"5d57":function(e,t,i){"use strict";i.r(t),i.d(t,"simulator",(function(){return n})),i.d(t,"statemanager",(function(){return d})),i.d(t,"settings",(function(){return b})),i.d(t,"status",(function(){return _})),i.d(t,"auth",(function(){return v})),i.d(t,"scene",(function(){return w})),i.d(t,"state",(function(){return I})),i.d(t,"farmbot",(function(){return L})),i.d(t,"angelBot",(function(){return W}));var s=i("633b");class n{constructor(e={}){this.canvas=e.canvas,this.events=e.events,this.engine=new s["Engine"](this.canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})}}var o=i("9523"),a=i.n(o),l=(i("ddb0"),i("13d5"),i("e7fc")),r=i.n(l),c=i("bc3a"),m=i.n(c),h=i("1712");class d{constructor(e={}){a()(this,"botInstances",{}),this.events=e.events,this.debug=e.debug||!1,this.port=e.port||8787,this.uptime=0,this.timer=null,this.broker=null,this.token=null,this.botId=null,this.deviceOnline=!1,this.otherClients=!1,this.mqttStatus=!1,this.userEnv={},this.location={x:0,y:0,z:0}}stopTimerRunTimer(){try{this.uptime=0,clearInterval(this.timer)}catch(e){}this.timer=setInterval((()=>{this.uptime++}),1e3)}async connectMQTT(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;return t=`wss://${t}:443/ws/mqtt`,console.log(`bot/${s}/#`),console.log({broker:t,token:i,botId:s}),this.broker=t,this.token=i,this.botId=s,new Promise(((e,n)=>{const o=r.a.connect(t,{clean:!0,password:i,protocolId:"MQIsdp",protocolVersion:3,username:s});console.log(s),console.log(s),console.log(s),o.on("error",(function(e){console.log("Can't connect"+e),n(e)})),o.on("connect",(async()=>{o.subscribe(`bot/${s}/#`,{qos:1}),e(o)}))}))}async delay(e){return new Promise(((t,i)=>{setTimeout((()=>t(!0)),e)}))}setMqttStatus(e){e!==this.mqttStatus&&(this.mqttStatus=e,this.events.emit("mqtt",e?"online":"offline"))}sendPingPong(e,t){this.client.publish(`bot/${this.botId}/${t}/${e}`,e.toString())}setDeviceStatus(e,t){switch(t){case"deviceOnline":this.deviceOnline=e,this.events.emit("status",{Device:e});break;case"otherClients":this.otherClients=e,this.events.emit("status",{"Other Clients":e});break;default:}}async scheduleMonitorDeviceStatus(){let e=[],t=[],i=[],s=[],n=2e3,o=n,a=1e4,l=2e3,r=0,c=0,m=0,d=[],p=[],u={},[b,_]=await Object(h["default"])(this.connectMQTT());if(b)throw b;let y=_;setInterval((()=>{let e=(new Date).getTime();e-r>=n&&(d.push(e),this.sendPingPong(e,"ping"))}),n),setInterval((()=>{let e=(new Date).getTime();for(let t in u){let i=parseInt(t),s=u[t];e-i>=o&&(p.push(parseInt(s)),this.sendPingPong(s,"pong"))}}),o),setInterval((()=>{e.length>.5*t.length?this.setDeviceStatus(!0,"otherClients"):this.setDeviceStatus(!1,"otherClients"),i.length>.5*s.length?this.setDeviceStatus(!0,"deviceOnline"):this.setDeviceStatus(!1,"deviceOnline"),t=[],e=[],s=[],i=[]}),a),setInterval((()=>{let e=(new Date).getTime();e-m>5*l&&this.setMqttStatus(!1)}),l),y.on("message",((n,o)=>{try{o=o.toString();let a=n.split("/")[2];switch(m=(new Date).getTime(),this.setMqttStatus(!0),a){case"ping":if(r=(new Date).getTime(),d.includes(parseInt(o))){t.push(r);let e=d.indexOf(o);d.splice(e,1)}else e.push(r),this.sendPingPong(o,"pong"),p.push(parseInt(msgData));u[r]=o;break;case"pong":if(c=(new Date).getTime(),p.includes(parseInt(o))){s.push(c);let e=p.indexOf(o);p.splice(e,1)}else i.push(c);for(let e in u){let t=u[e];t===o&&delete u[e]}break}}catch(b){}}))}async startOrRestartSimulator(){this.stopTimerRunTimer();let e=setInterval((()=>{this.events.emit("mqtt","waiting for connection")}),1e3),[t,i]=await Object(h["default"])(this.connectMQTT());if(t)throw t;clearInterval(e),this.client=i,this.monitorMQTT(),this.events.emit("mqtt","connected"),this.scheduleMonitorDeviceStatus(),this.schedulePublishTelemetry(),this.schedulePublishLogs(),this.schedulePublishStatusMessage(),this.monitorDownlinkMessages()}monitorMQTT(){this.client;this.events.on("mqtt",(e=>{"offline"===e&&this.events.emit("status",{mqtt:!1}),"online"===e&&this.events.emit("status",{mqtt:!0}),console.log("listener:",e)}))}publishFromDevice(e){let t={args:{label:e.label},kind:"rpc_ok"};this.publishGeneralData(t,"from_device")}setUserEnv(e){for(let t in e){let i=e[t].kind;switch(i){case"pair":let i=e[t].args;this.userEnv[i.label]=i.value;break}}}linearPath(e,t,i){console.log(e,t,i);let s=0,n=e.map((e=>[t[s++],e])),o=n.map((e=>e[0]-e[1])),a=Math.sqrt(o.map((e=>e*e)).reduce(((e,t)=>e+t))),l=a/i,r=o.map((e=>e/l));return{distance:a,time:l,speeds:r}}setPosition(e){let[t,i,s]=e,n=!1;t===this.location.x&&i===this.location.y&&s===this.location.z||(n=!0),this.location.x=t,this.location.y=i,this.location.z=s,n&&(console.log("LOCATION",[t,i,s]),this.events.emit("location",[t,i,s]))}async moveBot(e,t){return new Promise(((i,s)=>{let{distance:n,time:o,speeds:a}=e,l=[this.location.x,this.location.y,this.location.z],r=0,c=16,m=setInterval((()=>{let e=0;r+=c;let t=l.map((t=>t+a[e++]*r/1e3));this.setPosition(t),this.publishStatusMessage()}),c),h=1e3*o;setTimeout((()=>{clearInterval(m);let e=0;l.map((t=>t+a[e++]*h/1e3));this.setPosition(t),this.publishStatusMessage(),i(!0)}),h)}))}async moveRelative(e,t){let{x:i,y:s,z:n,speed:o}=e,a=[i,s,n],l={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving relative to (${a[0]},${a[1]},${a[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(l),this.publishGeneralData(l,"logs");let r=[this.location.x,this.location.y,this.location.z],c=[...a],m=0;c=c.map((e=>r[m++]+e));let h=this.linearPath(r,c,o);await this.moveBot(h,c),this.publishFromDevice(t)}async moveAbsolute(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,o=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let a=[this.location.x,this.location.y,this.location.z];for(let c in i)i[c]!==a[c]&&(i[c]=a[c]);let l={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${o[0]},${o[1]},${o[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(l),this.publishGeneralData(l,"logs");let r=this.linearPath(i,s,n);console.log(r);for(let c in this.botInstances)this.botInstances[c].moveAbsolute(o);await this.moveBot(r,s),this.publishFromDevice(t)}async processRpcRequests(e,t){for(let i in e){let s=e[i].kind;switch(s){case"set_user_env":this.setUserEnv(e[i].body),this.publishFromDevice(t);break;case"move_absolute":this.moveAbsolute(e[i].args,t);break;case"move_relative":this.moveRelative(e[i].args,t);break}}}async processFromClientTopicMessages(e,t){try{t=decodeURIComponent(t)}catch(o){}try{t=JSON.parse(t)}catch(o){}console.log(t);let i=t.kind,s=t.body,n=t.args;switch(console.log(i),console.log(s),i){case"rpc_request":this.processRpcRequests(s,n);break}}processSyncMessages(e,t){let i=e.split("/")[3];switch(i){case"FarmwareEnv":this.publishFromDevice(t.args);break;case"Device":this.publishFromDevice(t.args),this.deviceSync=t.body;break}}monitorDownlinkMessages(){let e=this.client;e.on("message",((e,t)=>{try{let i=e.split("/")[2];switch(i){case"from_clients":this.processFromClientTopicMessages(e,t);break;case"sync":this.processSyncMessages(e,t);break}}catch(i){}}))}publishGeneralData(e,t){"object"===typeof e&&(e=JSON.stringify(e)),this.client.publish(`bot/${this.botId}/${t}`,e)}schedulePublishLogs(){let e={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:"Farmbot is up and running!",meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"success",verbosity:1,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(e,"logs")}schedulePublishTelemetry(){let e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_configure","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:140,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"9ff8173c-5fe2-4b50-b2db-da38ad52ecc4","telemetry.value":null};this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"reset","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:reset_ntp, 0}",line:358,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"ntp","telemetry.uuid":"95ea2925-53e7-4e3c-a4f5-227cefe99eb6","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:181,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"621e5ee8-0d71-4f79-b5ec-6b67253f5908","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"a94eb734-bfa8-4664-8e39-e47aba534c4b","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"connection_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:handle_info, 2}",line:120,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"b0acda3b-8e27-438f-aa36-c65e08a5dc93","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/log_channel.ex",function:"{:handle_info, 2}",line:43,module:"Elixir.FarmbotExt.AMQP.LogChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"7b6b7de5-d2f7-469d-afa6-72b8cd065c1c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"6d150eb5-0c03-46d9-b17d-bd668711af05","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/telemetry_channel.ex",function:"{:handle_info, 2}",line:58,module:"Elixir.FarmbotExt.AMQP.TelemetryChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"550154f8-93ef-4fb4-8efe-72fc9f9f30bb","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/bot_state_channel.ex",function:"{:handle_info, 2}",line:57,module:"Elixir.FarmbotExt.AMQP.BotStateChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"dbace292-522f-4ce5-a0d9-d70869693a1a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:6,telemetry_disk_usage:0,telemetry_memory_usage:44,telemetry_scheduler_usage:6,telemetry_soc_temp:50,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:73,module:"Elixir.FarmbotExt.AMQP.PingPongChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"fa9183a8-8829-4f67-a743-45a2bb54c38c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:53,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"97d452cf-e39b-4deb-aad2-7256757aec9a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:54,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel",queue_name:`${this.botId}_from_clients`,routing_key:`bot.${this.botId}.from_clients`},"telemetry.subsystem":"amqp","telemetry.uuid":"f5b25e2a-5593-4163-bc01-f9c34cb75cf2","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:75,module:"Elixir.FarmbotExt.AMQP.PingPongChannel",queue_name:`${this.botId}_ping`,routing_key:`bot.${this.botId}.ping.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"3ca9da32-0812-43e1-a809-482b98708562","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:62,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"2f2988a2-f290-4e1d-b396-8723cd417e81","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:63,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker",queue_name:`${this.botId}_auto_sync`,routing_key:`bot.${this.botId}.sync.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"4d265203-176c-4ff5-8748-4523382a6a00","telemetry.value":null},setInterval((()=>{let e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:2,telemetry_disk_usage:0,telemetry_memory_usage:53,telemetry_scheduler_usage:2,telemetry_soc_temp:41,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90};this.publishGeneralData(e,"telemetry")}),3e5)}publishStatusMessage(){let e={configuration:{arduino_debug_messages:!1,auto_sync:!1,beta_opt_in:!1,disable_factory_reset:!1,firmware_debug_log:!1,firmware_hardware:"farmduino_k14",firmware_input_log:!1,firmware_output_log:!1,network_not_found_timer:null,os_auto_update:!1,sequence_body_log:!1,sequence_complete_log:!1,sequence_init_log:!1},informational_settings:{busy:!1,cache_bust:null,commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_uuid:"29417194-a853-55ef-6de8-91dd9b849b0b",controller_version:"10.1.4",cpu_usage:3,disk_usage:0,env:"prod",firmware_commit:"1711db1d9923bc295f81a5eb9952f6b3a10db6a9",firmware_version:"6.4.2.G",idle:!0,last_status:null,locked:!1,memory_usage:60,node_name:"farmbot@farmbot-000000004ed75c64.local",private_ip:"192.168.100.30",scheduler_usage:3,soc_temp:34,sync_status:"sync_now",target:"rpi3",throttled:"0x0",update_available:!0,uptime:this.uptime,wifi_level:-37,wifi_level_percent:91},jobs:{},location_data:{axis_states:{x:"unknown",y:"unknown",z:"unknown"},load:{x:null,y:null,z:null},position:{x:this.location.x,y:this.location.y,z:this.location.z},raw_encoders:{x:0,y:0,z:0},scaled_encoders:{x:0,y:0,z:0}},mcu_params:{movement_stall_sensitivity_z:30,movement_stop_at_max_y:0,encoder_missed_steps_max_y:5,movement_keep_active_y:1,movement_steps_acc_dec_y:300,movement_invert_2_endpoints_y:0,movement_keep_active_z:1,movement_max_spd_y:400,pin_guard_5_time_out:60,encoder_scaling_z:5556,pin_guard_4_pin_nr:0,pin_guard_3_time_out:60,movement_steps_acc_dec_x:300,encoder_missed_steps_decay_z:5,movement_home_up_x:0,movement_secondary_motor_invert_x:1,encoder_enabled_y:1,movement_axis_nr_steps_x:0,movement_motor_current_x:600,movement_timeout_x:120,movement_invert_endpoints_x:0,movement_home_spd_y:50,encoder_enabled_z:1,movement_enable_endpoints_z:0,movement_home_at_boot_y:0,movement_axis_nr_steps_z:0,movement_invert_motor_x:0,encoder_invert_z:0,movement_home_spd_z:50,encoder_type_y:0,movement_enable_endpoints_y:0,pin_guard_3_active_state:1,encoder_scaling_y:5556,movement_stop_at_max_x:0,encoder_missed_steps_decay_x:5,movement_timeout_z:120,encoder_scaling_x:5556,movement_keep_active_x:1,movement_min_spd_y:50,movement_max_spd_x:400,movement_stop_at_max_z:0,encoder_missed_steps_max_x:5,pin_guard_1_active_state:1,movement_home_up_z:1,encoder_missed_steps_decay_y:5,pin_guard_1_time_out:60,movement_step_per_mm_x:5,movement_home_at_boot_x:0,movement_invert_2_endpoints_z:0,movement_home_spd_x:50,pin_guard_4_active_state:1,movement_stall_sensitivity_x:30,encoder_type_x:0,movement_min_spd_z:50,pin_guard_3_pin_nr:0,pin_guard_2_pin_nr:0,pin_guard_5_active_state:1,pin_guard_2_active_state:1,movement_motor_current_y:600,movement_home_up_y:0,movement_axis_nr_steps_y:0,movement_stall_sensitivity_y:30,movement_invert_endpoints_z:0,movement_home_at_boot_z:0,movement_microsteps_y:1,pin_guard_1_pin_nr:0,movement_invert_motor_z:0,pin_guard_4_time_out:60,encoder_use_for_pos_x:0,pin_guard_5_pin_nr:0,encoder_invert_x:0,movement_step_per_mm_y:5,movement_invert_2_endpoints_x:0,encoder_use_for_pos_y:0,movement_invert_motor_y:0,movement_microsteps_x:1,param_mov_nr_retry:3,movement_min_spd_x:50,movement_invert_endpoints_y:0,movement_steps_acc_dec_z:300,movement_max_spd_z:400,movement_stop_at_home_z:0,param_e_stop_on_mov_err:0,movement_enable_endpoints_x:0,encoder_enabled_x:1,movement_microsteps_z:1,encoder_missed_steps_max_z:5,encoder_invert_y:0,pin_guard_2_time_out:60,movement_step_per_mm_z:25,encoder_type_z:0,movement_timeout_y:120,movement_secondary_motor_x:1,movement_stop_at_home_x:0,movement_motor_current_z:600,movement_stop_at_home_y:0,encoder_use_for_pos_z:0},pins:{},process_info:{farmwares:{}},user_env:{LAST_CLIENT_CONNECTED:this.userEnv.LAST_CLIENT_CONNECTED||'"2020-08-25T06:28:44.168Z"',camera:'"USB"'}};this.publishGeneralData(e,"status")}schedulePublishStatusMessage(){setInterval((()=>{this.publishStatusMessage()}),5e3)}}let p={farmbot:{genesis:{genesis:{length:3e3,width:1500,height:500},xl:{length:6e3,width:3e3,height:500}},express:{express:{length:3e3,width:1200,height:500},xl:{length:6e3,width:2400,height:500}},juakali:{custom:{length:1e4,width:2e3,height:1500}},mega:{"2R":{point0:[0,0],point1:[-100,1e4],point2:[900,9e3],point3:[1e3,100],height:2500},"4R":{point0:[0,0],point1:[-100,1e4],point2:[900,9e3],point3:[1e3,100],height:2500}}},tertil:{},port:8787},u={botType:"express",subType:"xl",port:p.port};class b{constructor(e={}){this.events=e.events,this.saveDefaults(),this.botOptions=p}saveDefaults(){let e={};try{e=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(i){e={}}e||(e={}),void 0===e.settings&&(e.settings={});for(let s in u){let t=u[s];void 0===e.settings[s]&&(e.settings[s]=t)}if(void 0===e.values){e.values={};let t=p.farmbot[e.settings.botType][e.settings.subType];e.values=t}if(0===Object.keys(e.values).length){let t=p.farmbot[e.settings.botType][e.settings.subType];e.values=t}let t=JSON.stringify(e);window.localStorage.setItem("farmbotSimulator",t)}getSettings(){let e={};try{e=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(i){e={}}void 0===e.settings&&(e.settings={});let t={};return t.settings=e.settings,t.values=e.values,t.options=JSON.parse(JSON.stringify(p)),t}writeSettings(e,t){let i=["length","width","height"],s=["point0","point1","point2","point3"],n=!1;for(let r in t){let e=t[r];if(i.includes(r)){let i=parseInt(e);isNaN(i)?n=!0:t[r]=i}let o=[];s.includes(r)&&(o="string"===typeof e?e.split(","):e,o=o.map((e=>{let t=parseInt(e);if(!isNaN(t))return t;n=!0})),2!==o.length&&(n=!0),t[r]=o)}if(n)return!1;let o={};try{o=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(l){o={}}o.settings=e,o.values=t;let a=JSON.stringify(o);return window.localStorage.setItem("farmbotSimulator",a),!0}}class _{constructor(e={}){this.events=e.events,this.status={Device:!1,"Other Clients":!1,Mathematica:!1,mqtt:!1},this.events.on("status",(e=>{this.processStatus(e)}))}processStatus(e){if("object"!==typeof e)return!1;for(let t in e){let i=e[t];this.status[t]=i}}getStatus(){return this.status}}const y="https://my.farmbot.io/api";class g{constructor(){}async checkTokenAndRefresh(){let e={};return new Promise((async(t,i)=>{try{if(e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,void 0===e)throw"missing token"}catch(a){return i("missing token")}let s=e.token;if(null===s)return i("missing token");let n={"content-type":"application/json",Authorization:`Bearer ${s}`},o={},[a,l]=await Object(h["default"])(m.a.get(`${y}/tokens`,{params:o,headers:n}));if(a)return i(a);this.setStatus({token:l.data.token.encoded}),this.refreshTokenData(),t(!0)}))}setStatus(e){let t={};try{t=JSON.parse(window.localStorage.getItem("farmbotSimulator"))||{}}catch(i){t={}}void 0===t.status&&(t.status={});for(let s in e)t.status[s]=e[s];t=JSON.stringify(t),window.localStorage.setItem("farmbotSimulator",t)}async logIn(e){return new Promise((async(t,i)=>{let[s,n]=await Object(h["default"])(m.a.post(`${y}/tokens`,{user:e}));return s?i(s.response.data.auth||s):(this.loggedIn(n.data),t(n.data))}))}loggedIn(e){let t=e.token,i=t.encoded,s=t.unencoded.mqtt,n=t.unencoded.bot;this.setStatus({token:i,broker:s,botId:n,user:e.user}),this.refreshTokenData()}logout(){try{let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")),t={};for(let i in e)"status"!==i&&(t[i]=e[i]);t=JSON.stringify(t),window.localStorage.setItem("farmbotSimulator",t),this.refreshTokenData()}catch(e){}}refreshTokenData(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;this.broker=t,this.token=i,this.botId=s}}const v=new g;i("5319");const x={"2d":"2D","3dconly":"Light 3D","3dbab":"Heavy 3D"};class f{constructor(){}allScenes(){return Object.values(x)}defaultScene(){let e=this.allScenes();return e[0]}setScene(e){window.localStorage.setItem("farmbotSimulator-scene",e)}getScene(){let e;try{e=window.localStorage.getItem("farmbotSimulator-scene")||!1}catch(t){}return e||(e=this.defaultScene(),this.setScene(e)),e}addRule(e,t){const i=(e,t)=>{let i=[];for(let n=0;n<document.styleSheets.length;n++){let o=document.styleSheets[n];const a=o.cssRules;let l,r=(t?e+"{"+t+"}":e).replace(/\s/g,""),c=t?"cssText":"selectorText";for(l=0;l<a.length;l++)try{let e=new RegExp(r.replace(/\(/g,"\\(").replace(/\)/g,"\\)"),"g");a[l][c].match(e)&&i.push([o,l,a[l][c]])}catch(s){}}return i};let s=i(e);s.map((([e,i,s])=>{let n="string"===typeof t?t:Object.keys(t).map((function(e){return e+":"+("content"===e?"'"+t[e]+"'":t[e])})).join(";");e.deleteRule(i),e.insertRule(s+"{"+n+"}",e.cssRules.length)}))}}const w=new f;var B=i("faa1"),S=i.n(B);const T="https://my.farmbot.io/api",k={device:"device",points:"points",savedGardens:"saved_gardens",regimens:"regimens",sequences:"sequences"};class P extends S.a{constructor(){super(),a()(this,"botInstances",{}),this.uptime=0,this.timer=null,this.broker=null,this.token=null,this.botId=null,this.deviceOnline=!1,this.otherClients=!1,this.mqttStatus=!1,this.userEnv={},this.location={x:0,y:0,z:0},this.status={mqtt:"waiting"},this.refreshTokenData()}getToken(){return this.token}async startOrRestartSimulator(){this.refreshTokenData(),this.stopTimerRunTimer(),this.emit("status",{message:"mqtt waiting for connection"}),this.status.mqtt="waiting";let[e,t]=await Object(h["default"])(this.connectMQTT());if(e)throw e;this.client=t,this.emit("status",{type:"positive",message:"mqtt connected"}),this.status.mqtt="connected",this.scheduleMonitorDeviceStatus(),this.schedulePublishTelemetry(),this.schedulePublishLogs(),this.schedulePublishStatusMessage(),this.monitorDownlinkMessages()}headers(){let e={Authorization:`Bearer ${this.token}`,"content-type":"application/json"};return{headers:e}}async savedGardens(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(m.a.get(`${T}/saved_gardens`,this.headers()));if(i)return t(i);e(s.data)}))}async points(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(m.a.get(`${T}/points`,this.headers()));if(i)return t(i);e(s.data)}))}async farmbotGET(e){return new Promise((async(t,i)=>{let s=k[e];s||(s=e.replace(/([a-z])([A-Z])/,((e,t,i,s,n)=>t+"_"+i.toLowerCase())));let[n,o]=await Object(h["default"])(m.a.get(`${T}/${s}`,this.headers()));if(n)return i(n);t(o.data)}))}async farmbotPOST(e,t){return new Promise((async(i,s)=>{let n=k[e];n||(n=e.replace(/([a-z])([A-Z])/,((e,t,i,s,n)=>t+"_"+i.toLowerCase())));let[o,a]=await Object(h["default"])(m.a.post(`${T}/${n}`,t,this.headers()));if(o)return s(o);i(a.data)}))}async deleteDevice(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(this.farmbotGET("device"));if(i)return t(i);let n=s,o=(new Date).toISOString();n.last_saw_api=o,[i,s]=await Object(h["default"])(this.farmbotPOST("device",n)),[i,s]=await Object(h["default"])(this.farmbotGET("device")),e(s)}))}async fixDeviceAPI(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(this.farmbotGET("device"));if(console.log("device",s),console.log(i),i)return t(i);let n=s,o=(new Date).toISOString();console.log(o,typeof o),n.last_saw_api=o,[i,s]=await Object(h["default"])(this.farmbotPOST("device",n)),console.log(i),console.log(s),[i,s]=await Object(h["default"])(this.farmbotGET("device")),console.log(i),console.log(s),e(s)}))}refreshTokenData(){let e=(JSON.parse(window.localStorage.getItem("farmbotSimulator"))||{}).status||{},{broker:t,token:i,botId:s}=e;this.broker=t,this.token=i,this.botId=s}removeAllListeners(){try{this.client.end()}catch(e){}}stopTimerRunTimer(){try{this.uptime=0,clearInterval(this.timer)}catch(e){}this.timer=setInterval((()=>{this.uptime++}),1e3)}async connectMQTT(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;return t=`wss://${t}:443/ws/mqtt`,console.log({broker:t,token:i,botId:s}),new Promise(((e,n)=>{const o=r.a.connect(t,{clean:!0,password:i,protocolId:"MQIsdp",protocolVersion:3,username:s});o.on("error",(function(e){console.log("Can't connect"+e),n(e)})),o.on("connect",(async()=>{o.subscribe(`bot/${this.botId}/#`,{qos:1}),e(o)}))}))}async delay(e){return new Promise(((t,i)=>{setTimeout((()=>t(!0)),e)}))}setMqttStatus(e){e!==this.mqttStatus&&(this.mqttStatus=e,this.events.emit("mqtt",e?"online":"offline"))}sendPingPong(e,t){this.client.publish(`bot/${this.botId}/${t}/${e}`,e.toString())}setDeviceStatus(e,t){switch(t){case"deviceOnline":this.deviceOnline=e,this.emit("status",` Device: ${e}`);break;case"otherClients":this.otherClients=e,this.emit("status",` Other Clients: ${e}`);break;default:}}async scheduleMonitorDeviceStatus(){let e=[],t=[],i=[],s=[],n=2e3,o=n,a=1e4,l=2e3,r=0,c=0,m=0,d=[],p=[],u={},[b,_]=await Object(h["default"])(this.connectMQTT());if(b)throw b;let y=_;setInterval((()=>{let e=(new Date).getTime();e-r>=n&&(d.push(e),this.sendPingPong(e,"ping"))}),n),setInterval((()=>{let e=(new Date).getTime();for(let t in u){let i=parseInt(t),s=u[t];e-i>=o&&(p.push(parseInt(s)),this.sendPingPong(s,"pong"))}}),o),setInterval((()=>{e.length>.5*t.length?this.setDeviceStatus(!0,"otherClients"):this.setDeviceStatus(!1,"otherClients"),i.length>.5*s.length?this.setDeviceStatus(!0,"deviceOnline"):this.setDeviceStatus(!1,"deviceOnline"),t=[],e=[],s=[],i=[]}),a),setInterval((()=>{let e=(new Date).getTime();e-m>5*l&&this.setMqttStatus(!1)}),l),console.log("client"),console.log("client"),console.log(y),console.log("client"),y.on("message",((n,o)=>{try{o=o.toString();let a=n.split("/")[2];switch(m=(new Date).getTime(),this.setMqttStatus(!0),a){case"ping":if(r=(new Date).getTime(),d.includes(parseInt(o))){t.push(r);let e=d.indexOf(o);d.splice(e,1)}else e.push(r),this.sendPingPong(o,"pong"),p.push(parseInt(msgData));u[r]=o;break;case"pong":if(c=(new Date).getTime(),p.includes(parseInt(o))){s.push(c);let e=p.indexOf(o);p.splice(e,1)}else i.push(c);for(let e in u){let t=u[e];t===o&&delete u[e]}break}}catch(b){}}))}publishFromDevice(e){let t={args:{label:e.label},kind:"rpc_ok"};this.publishGeneralData(t,"from_device")}setUserEnv(e){for(let t in e){let i=e[t].kind;switch(i){case"pair":let i=e[t].args;this.userEnv[i.label]=i.value;break}}}linearPath(e,t,i){console.log(e,t,i);let s=0,n=e.map((e=>[t[s++],e])),o=n.map((e=>e[0]-e[1])),a=Math.sqrt(o.map((e=>e*e)).reduce(((e,t)=>e+t))),l=a/i,r=o.map((e=>e/l));return{distance:a,time:l,speeds:r}}setPosition(e){let[t,i,s]=e,n=!1;t===this.location.x&&i===this.location.y&&s===this.location.z||(n=!0),this.location.x=t,this.location.y=i,this.location.z=s}async moveBot(e,t){return new Promise(((e,t)=>e(!0)))}async moveRelative(e,t){let{x:i,y:s,z:n,speed:o}=e,a=[i,s,n],l={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving relative to (${a[0]},${a[1]},${a[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(l),this.publishGeneralData(l,"logs");let r=[this.location.x,this.location.y,this.location.z],c=[...a];for(let d in this.botInstances)this.botInstances[d].moveRelative(c,(e=>{this.setPosition(e),this.publishStatusMessage()}));let m=0;c=c.map((e=>r[m++]+e));let h=this.linearPath(r,c,o);await this.moveBot(h,c),this.publishFromDevice(t)}async moveAbsolute(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,o=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let a=[this.location.x,this.location.y,this.location.z];for(let c in i)i[c]!==a[c]&&(i[c]=a[c]);let l={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${o[0]},${o[1]},${o[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(l,"logs");let r=this.linearPath(i,s,n);for(let c in this.botInstances)this.botInstances[c].moveAbsolute(s,(e=>{this.setPosition(e),this.publishStatusMessage()}));await this.moveBot(r,s),this.publishFromDevice(t)}async move(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,o=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let a=[this.location.x,this.location.y,this.location.z];for(let c in i)i[c]!==a[c]&&(i[c]=a[c]);let l={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${o[0]},${o[1]},${o[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(l,"logs");let r=this.linearPath(i,s,n);for(let c in this.botInstances)this.botInstances[c].moveAbsolute(s,(e=>{this.setPosition(e),this.publishStatusMessage()}));await this.moveBot(r,s),this.publishFromDevice(t)}async processRpcRequests(e,t){for(let i in e){let s=e[i].kind;switch(s){case"set_user_env":this.setUserEnv(e[i].body),this.publishFromDevice(t);break;case"move_absolute":this.moveAbsolute(e[i].args,t);break;case"move_relative":this.moveRelative(e[i].args,t);break;case"move":let s={offset:{kind:"coordinate",args:{x:0,y:0,z:0}},location:{kind:"coordinate",args:e[i].body[0].args.axis_operand.args}};this.moveAbsolute(s,t);break}}}async processFromClientTopicMessages(e,t){try{t=decodeURIComponent(t)}catch(o){}try{t=JSON.parse(t)}catch(o){}console.log(t);let i=t.kind,s=t.body,n=t.args;switch(console.log(i),console.log(s),i){case"rpc_request":this.processRpcRequests(s,n);break}}processSyncMessages(e,t){let i=e.split("/")[3];switch(i){case"FarmwareEnv":this.publishFromDevice(t.args);break;case"Device":this.publishFromDevice(t.args),this.deviceSync=t.body;break}}monitorDownlinkMessages(){let e=this.client;e.on("message",((e,t)=>{try{let i=e.split("/")[2];switch(i){case"from_clients":this.processFromClientTopicMessages(e,t);break;case"sync":this.processSyncMessages(e,t);break}}catch(i){}}))}publishGeneralData(e,t){"object"===typeof e&&(e=JSON.stringify(e)),this.client.publish(`bot/${this.botId}/${t}`,e)}schedulePublishLogs(){let e={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:"Farmbot is up and running!",meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"success",verbosity:1,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(e,"logs")}schedulePublishTelemetry(){let e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_configure","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:140,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"9ff8173c-5fe2-4b50-b2db-da38ad52ecc4","telemetry.value":null};this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"reset","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:reset_ntp, 0}",line:358,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"ntp","telemetry.uuid":"95ea2925-53e7-4e3c-a4f5-227cefe99eb6","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:181,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"621e5ee8-0d71-4f79-b5ec-6b67253f5908","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"a94eb734-bfa8-4664-8e39-e47aba534c4b","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"connection_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:handle_info, 2}",line:120,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"b0acda3b-8e27-438f-aa36-c65e08a5dc93","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/log_channel.ex",function:"{:handle_info, 2}",line:43,module:"Elixir.FarmbotExt.AMQP.LogChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"7b6b7de5-d2f7-469d-afa6-72b8cd065c1c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"6d150eb5-0c03-46d9-b17d-bd668711af05","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/telemetry_channel.ex",function:"{:handle_info, 2}",line:58,module:"Elixir.FarmbotExt.AMQP.TelemetryChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"550154f8-93ef-4fb4-8efe-72fc9f9f30bb","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/bot_state_channel.ex",function:"{:handle_info, 2}",line:57,module:"Elixir.FarmbotExt.AMQP.BotStateChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"dbace292-522f-4ce5-a0d9-d70869693a1a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:6,telemetry_disk_usage:0,telemetry_memory_usage:44,telemetry_scheduler_usage:6,telemetry_soc_temp:50,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:73,module:"Elixir.FarmbotExt.AMQP.PingPongChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"fa9183a8-8829-4f67-a743-45a2bb54c38c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:53,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"97d452cf-e39b-4deb-aad2-7256757aec9a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:54,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel",queue_name:`${this.botId}_from_clients`,routing_key:`bot.${this.botId}.from_clients`},"telemetry.subsystem":"amqp","telemetry.uuid":"f5b25e2a-5593-4163-bc01-f9c34cb75cf2","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:75,module:"Elixir.FarmbotExt.AMQP.PingPongChannel",queue_name:`${this.botId}_ping`,routing_key:`bot.${this.botId}.ping.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"3ca9da32-0812-43e1-a809-482b98708562","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:62,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"2f2988a2-f290-4e1d-b396-8723cd417e81","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:63,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker",queue_name:`${this.botId}_auto_sync`,routing_key:`bot.${this.botId}.sync.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"4d265203-176c-4ff5-8748-4523382a6a00","telemetry.value":null},setInterval((()=>{let e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:2,telemetry_disk_usage:0,telemetry_memory_usage:53,telemetry_scheduler_usage:2,telemetry_soc_temp:41,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90};this.publishGeneralData(e,"telemetry")}),3e5)}publishStatusMessage(){let e={configuration:{arduino_debug_messages:!1,auto_sync:!1,beta_opt_in:!1,disable_factory_reset:!1,firmware_debug_log:!1,firmware_hardware:"farmduino_k14",firmware_input_log:!1,firmware_output_log:!1,network_not_found_timer:null,os_auto_update:!1,sequence_body_log:!1,sequence_complete_log:!1,sequence_init_log:!1},informational_settings:{busy:!1,cache_bust:null,commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_uuid:"29417194-a853-55ef-6de8-91dd9b849b0b",controller_version:"10.1.4",cpu_usage:3,disk_usage:0,env:"prod",firmware_commit:"1711db1d9923bc295f81a5eb9952f6b3a10db6a9",firmware_version:"6.4.2.G",idle:!0,last_status:null,locked:!1,memory_usage:60,node_name:"farmbot@farmbot-000000004ed75c64.local",private_ip:"192.168.100.30",scheduler_usage:3,soc_temp:34,sync_status:"sync_now",target:"rpi3",throttled:"0x0",update_available:!0,uptime:this.uptime,wifi_level:-37,wifi_level_percent:91},jobs:{},location_data:{axis_states:{x:"unknown",y:"unknown",z:"unknown"},load:{x:null,y:null,z:null},position:{x:this.location.x,y:this.location.y,z:this.location.z},raw_encoders:{x:0,y:0,z:0},scaled_encoders:{x:0,y:0,z:0}},mcu_params:{movement_stall_sensitivity_z:30,movement_stop_at_max_y:0,encoder_missed_steps_max_y:5,movement_keep_active_y:1,movement_steps_acc_dec_y:300,movement_invert_2_endpoints_y:0,movement_keep_active_z:1,movement_max_spd_y:400,pin_guard_5_time_out:60,encoder_scaling_z:5556,pin_guard_4_pin_nr:0,pin_guard_3_time_out:60,movement_steps_acc_dec_x:300,encoder_missed_steps_decay_z:5,movement_home_up_x:0,movement_secondary_motor_invert_x:1,encoder_enabled_y:1,movement_axis_nr_steps_x:0,movement_motor_current_x:600,movement_timeout_x:120,movement_invert_endpoints_x:0,movement_home_spd_y:50,encoder_enabled_z:1,movement_enable_endpoints_z:0,movement_home_at_boot_y:0,movement_axis_nr_steps_z:0,movement_invert_motor_x:0,encoder_invert_z:0,movement_home_spd_z:50,encoder_type_y:0,movement_enable_endpoints_y:0,pin_guard_3_active_state:1,encoder_scaling_y:5556,movement_stop_at_max_x:0,encoder_missed_steps_decay_x:5,movement_timeout_z:120,encoder_scaling_x:5556,movement_keep_active_x:1,movement_min_spd_y:50,movement_max_spd_x:400,movement_stop_at_max_z:0,encoder_missed_steps_max_x:5,pin_guard_1_active_state:1,movement_home_up_z:1,encoder_missed_steps_decay_y:5,pin_guard_1_time_out:60,movement_step_per_mm_x:5,movement_home_at_boot_x:0,movement_invert_2_endpoints_z:0,movement_home_spd_x:50,pin_guard_4_active_state:1,movement_stall_sensitivity_x:30,encoder_type_x:0,movement_min_spd_z:50,pin_guard_3_pin_nr:0,pin_guard_2_pin_nr:0,pin_guard_5_active_state:1,pin_guard_2_active_state:1,movement_motor_current_y:600,movement_home_up_y:0,movement_axis_nr_steps_y:0,movement_stall_sensitivity_y:30,movement_invert_endpoints_z:0,movement_home_at_boot_z:0,movement_microsteps_y:1,pin_guard_1_pin_nr:0,movement_invert_motor_z:0,pin_guard_4_time_out:60,encoder_use_for_pos_x:0,pin_guard_5_pin_nr:0,encoder_invert_x:0,movement_step_per_mm_y:5,movement_invert_2_endpoints_x:0,encoder_use_for_pos_y:0,movement_invert_motor_y:0,movement_microsteps_x:1,param_mov_nr_retry:3,movement_min_spd_x:50,movement_invert_endpoints_y:0,movement_steps_acc_dec_z:300,movement_max_spd_z:400,movement_stop_at_home_z:0,param_e_stop_on_mov_err:0,movement_enable_endpoints_x:0,encoder_enabled_x:1,movement_microsteps_z:1,encoder_missed_steps_max_z:5,encoder_invert_y:0,pin_guard_2_time_out:60,movement_step_per_mm_z:25,encoder_type_z:0,movement_timeout_y:120,movement_secondary_motor_x:1,movement_stop_at_home_x:0,movement_motor_current_z:600,movement_stop_at_home_y:0,encoder_use_for_pos_z:0},pins:{},process_info:{farmwares:{}},user_env:{LAST_CLIENT_CONNECTED:this.userEnv.LAST_CLIENT_CONNECTED||'"2020-08-25T06:28:44.168Z"',camera:'"USB"'}};this.publishGeneralData(e,"status")}schedulePublishStatusMessage(){setInterval((()=>{this.publishStatusMessage()}),5e3)}}const I=new P;var M=i("e6a9");class O{constructor(){}connect(){let e=I.getToken(),t=new M["Farmbot"]({token:e});t.connect()}}const L=new O;i("26e9");const z="ubuntu.cseco.co.ke",N="1882";class A{constructor(e,t,i){a()(this,"askForPlantInterval",null),this.parent=e,this.instanceNumber=i,this.connectMQTT(t)}async connectMQTT(e){let{instanceNumber:t}=this,i=`wss://${z}:${N}/mqtt`,s=e.user.email;return new Promise(((n,o)=>{const a=r.a.connect(i,{clean:!0,password:e.user.password,protocolId:"MQIsdp",protocolVersion:3,username:s});this.client=a,a.on("error",(function(e){o(e)})),a.on("connect",(async()=>{console.log("connected"),a.subscribe(`${s}`,{qos:1}),n(a)})),a.on("message",((e,i)=>{if(e===s){a.unsubscribe(s),this.botId=i.toString();let e="/"+this.botId+"/#";a.subscribe(e,{qos:1}),this.askForPlantLocations(),this.askForPlantInterval=setInterval((()=>{this.askForPlantLocations()}),1e4)}let n=i.toString();switch(e.split("/")[2]){case"SET":let i=e.split("/")[3];switch(i){case"points":this.parent.processPoints(JSON.parse(n),t);break}break;case"move_relative":this.parent.moveRelative(JSON.parse(n),t);break;case"move_absolute":this.parent.moveAbsolute(JSON.parse(n),t);break}}))}))}publishGeneralData(e,t){"object"===typeof e&&(e=JSON.stringify(e)),this.client.publish(`/bot/${this.botId}/${t}`,e)}askForPlantLocations(){this.client.publish(`/${this.botId}/GET`,"points")}sendLocationData(e){}destroy(){try{clearTimeout(this.askForPlantInterval),this.client.end()}catch(e){}}}const D={"corn-mustard-1":{shapeId:4}};class C{constructor(e){this.parent=e}place(e,t,i){let s=e.instances[i],n=s.plants,o=Object.values(n).filter((e=>void 0===e.nodeId));o.map((t=>{let s,{planted_at:o,plant_stage:a,x:l,y:r,z:c,name:m,pointer_type:h,id:d}=t.plantData;s=this.placeGeneric(e,i,m),s&&(n[d]["nodeId"]=s)})),e.webotsView._view.animation._view.x3dScene.render()}getPlantShapeId(e){return Object.keys(D).includes(e)?D[e].shapeId:Object.values(D).slice(-1)[0].shapeId}placeGeneric(e,t,i){let s=e.getSoilTransform(t),n=this.getPlantShapeId(i),o=s.children[0].children[n],a=o.clone();a.parent=s.children[1].children[1].id,e.WbWorld.instance.nodes.set(a.id,a),s.children[1].children[1].children.push(a),a.finalize();let l={id:a.id,scale:[1e-4,1e-4,1e-4].join(",")};return e.webotsView._view.x3dScene._applyPoseToObject(l,a),a.id}positionPlants(e,t){let i=e.instances[t],s=i.plants;void 0!==s&&(Object.values(s).map((t=>{let{nodeId:s}=t,{x:n,y:o}=t.plantData;n=parseFloat(n),o=parseFloat(o);let a=e.WbWorld.instance.nodes.get(s);if(void 0===a)return;let l={id:a.id,translation:[(o-i.botWidth/2)/1e3,(n-i.botLength/2)/1e3,0].join(",")};e.webotsView._view.x3dScene._applyPoseToObject(l,a),l={id:a.id,scale:[.01,.01,.01].join(",")},e.webotsView._view.x3dScene._applyPoseToObject(l,a)})),e.webotsView._view.animation._view.x3dScene.render(),this.removeDeleted(e,t))}removeDeleted(e,t){let i=e.instances[t],s=i.plants;void 0!==s&&(Object.values(s).map((t=>{let{nodeId:s,deleted:n}=t;if(n){let t=e.WbWorld.instance.nodes.get(s),n=t.id,o=t.parent,a=e.WbWorld.instance.nodes.get(o);t.delete(),a.children=a.children.filter(((e,t)=>e.id!==n)),delete i.plants[s]}})),e.webotsView._view.animation._view.x3dScene.render())}position(){}}const{MixMaterial:E}=i("dd4a");i("8d5f").default;let q=new C;class Y{constructor(){a()(this,"instances",{}),a()(this,"hadstarted",!1),a()(this,"numInstances",0),a()(this,"initHandler",(()=>{this.hadstarted=!0;this.vueObj.$refs.botsElement})),a()(this,"botTypes",(e=>{let t=i("60a8"),s={};return e?(Object.keys(t).map((i=>{console.log({bot:i,application:e,as:t[i].applications});let n=t[i].applications||[];n.includes(e.toLowerCase())&&(s[i]=t[i].bots)})),s):{}})),a()(this,"applications",(()=>i("3b13"))),a()(this,"unloadScene",(e=>{})),a()(this,"changeBotType",(e=>{let t=this.instances[e];if(!t.botType||!t.botTypeType)return;let i=`${t.botType}${t.botTypeType}`;switch(i=i.toUpperCase().replace(/ /g,""),console.log(i),console.log(i),console.log(i),console.log(i),console.log(i),i){case"FARMBOTGENESIS":case"FARMBOTGENESISXL":case"FARMBOTGENESISMAX":case"FARMBOTEXPRESS":case"FARMBOTEXPRESSXL":case"FARMBOTEXPRESSMAX":t.bed=!0,t.workSpaceLength=this.botTypes(t.application)[t.botType][t.botTypeType].Length,t.workSpaceWidth=this.botTypes(t.application)[t.botType][t.botTypeType].Width,this.createGardenSoil(e);break;case"ANGELBOTGROUNDCABLE":case"ANGELBOTGROUNDRAIL":case"ANGELBOTAERIALCABLE":case"ANGELBOTAERIALRAIL":this.createGardenSoil(e);default:}})),a()(this,"getRootNode",(()=>{const e=document.getElementsByTagName("webots-view")[0],t=e._view.animation._view.x3dScene.WbWorld;let i=t.instance.sceneTree,s=/class ([^ ]+)/;return Array.from(i).reverse().filter(((e,t)=>"WbTransform"===s.exec(Object.getPrototypeOf(e).constructor.toString())[1]))[0]})),a()(this,"getRobotSNode",(e=>{let t=this.instances[e],i=this.WbWorld.instance.nodes.get(t.rootNodeId);return i.children[1].children[1].children[1]})),a()(this,"placeRobotZLocation",(e=>{let t,i=this.instances[e],s=this.getRobotSNode(e);t="Concrete"===i.bedType?{id:s.id,translation:"0,0,0.05"}:{id:s.id,translation:"0,0,0.02"},this.webotsView._view.animation._view.x3dScene._applyPoseToObject(t,s)})),a()(this,"getRobotParts",(e=>{this.instances[e];let t=this.getRobotSNode(e),i=this.getDescendantNode(t,[0,0]),s=this.getDescendantNode(t,[0,1]),n=this.getDescendantNode(t,[0,2,0]),o=this.getDescendantNode(t,[0,2,1,0]),a=this.getDescendantNode(t,[0,2,1,0,1]),l=this.getDescendantNode(t,[0,2,1,0,1,0]);return{getRobotSNode:t,rightGantryColumn:i,leftGantryColumn:s,gantryBeam:n,CrossSlideNCo:o,zAxisNUTM:a,zAxis:l}})),a()(this,"resizeRobot",(e=>{let t=this.instances[e],{rightGantryColumn:i,leftGantryColumn:s,gantryBeam:n,CrossSlideNCo:o,zAxisNUTM:a,zAxis:l}=this.getRobotParts(e);this.applyTransformation(i,"translation",[t.botWidth/2e3,0,0]),this.applyTransformation(i.children[0],"scale",[1,1,(650+t.plantHeight-500)/650]),this.applyTransformation(i.children[12],"translation",[.012,-.132,.067+(t.plantHeight-500)/1e3]),this.applyTransformation(s,"translation",[-t.botWidth/2e3,0,0]),this.applyTransformation(s.children[0],"scale",[1,1,(650+t.plantHeight-500)/650]),this.applyTransformation(s.children[12],"translation",[-.011,.001,.06+(t.plantHeight-500)/1e3]),this.applyTransformation(n,"scale",[1,1,4.65*t.botWidth/3e3]),this.applyTransformation(n,"translation",[t.botWidth/2e3,n.translation.y,.8+(t.plantHeight-500)/1e3]),this.applyTransformation(o,"translation",[0,0,-t.botWidth/2e3]);{let e=500+t.plantHeight;this.applyTransformation(l,"scale",[1,1,e/750])}this.webotsView._view.x3dScene.render()})),a()(this,"moveBot",((e,t=!1,i,s="dontcare")=>{let n=this.instances[e],{zAxis:o,getRobotSNode:a,CrossSlideNCo:l,zAxisNUTM:r}=this.getRobotParts(e);i=i||{};let{x:c,y:m,z:h,speed:d}=i;c="number"===typeof c?c:n.location.x,m="number"===typeof m?m:n.location.y,h="number"===typeof h?h:n.location.z,d=d||n.location.speed;let p=++n.movingRequestId,u=.75*o.scale.z,b=u-.35,_={x:[-n.botWidth/2e3,n.botWidth/2e3-.2],y:[-n.botLength/2e3,n.botLength/2e3-.2],z:[0,b]},y={x:c,y:m,z:h},g={x:-n.botWidth/2,y:-n.botLength/2,z:0};for(let v in _)_[v]=_[v].map((e=>1e3*e-g[v]));if(c<_["x"][0]?c=_["x"][0]:c>_["x"][1]&&(c=_["x"][1]),m<_["y"][0]?m=_["y"][0]:m>_["y"][1]&&(m=_["y"][1]),h<_["z"][0]?h=_["z"][0]:h>_["z"][1]&&(h=_["z"][1]),console.log({premits:y,limits:_,x:c,y:m,z:h}),t)this.applyTransformation(l,"translation",[0,0,-n.botWidth/2e3+c/1e3]),this.applyTransformation(a,"translation",[0,-n.botLength/2e3+m/1e3,a.translation.z]),this.applyTransformation(r,"translation",[-h/1e3,0,0]),n.location.x=c,n.location.y=m,n.location.z=h,this.webotsView._view.x3dScene.render();else{let t=l.translation.z- -n.botWidth/2e3,i=a.translation.y- -n.botLength/2e3,o=-r.translation.x;t*=1e3,i*=1e3,o*=1e3;let u={x:c-t,y:m-i,z:h-o},b=Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)+Math.pow(u.z,2));if(0===b)return;let _=u.x/Math.abs(u.x),y=u.y/Math.abs(u.y),g=u.z/Math.abs(u.z);0===u.x&&(_=1),0===u.y&&(y=1),0===u.z&&(g=1);let v=u.x/b*d,x=u.y/b*d,f=u.z/b*d,w=.1,B=0,S=5,T=setInterval((()=>{if(n.movingRequestId!=p)return void clearInterval(T);t=l.translation.z- -n.botWidth/2e3,i=a.translation.y- -n.botLength/2e3,o=-r.translation.x,t*=1e3,i*=1e3,o*=1e3;let d=t+v*w,u=i+x*w,b=o+f*w,k=!1;(-1===_&&d<c||1===_&&d>c)&&(k=!0),(-1===y&&u<m||1===y&&u>m)&&(k=!0),(-1===g&&b<h||1===g&&b>h)&&(k=!0),k&&(d=c,u=m,b=h,n.movingRequestId++),this.applyTransformation(l,"translation",[0,0,-n.botWidth/2e3+d/1e3]),this.applyTransformation(a,"translation",[0,-n.botLength/2e3+u/1e3,a.translation.z]),this.applyTransformation(r,"translation",[-b/1e3,0,0]),n.location.x=d,n.location.y=u,n.location.z=b,this.webotsView._view.x3dScene.render(),k||B>=S?(this.publishLogs({x:c,y:m,z:h},"relative"===s,e),B=0):B+=w}),1e3*w)}})),a()(this,"addSelector",(()=>{if(!this.startedSelector){const e=document.getElementsByTagName("webots-view")[0];e.mouseEventsExtra.onmouseup=t=>{let i,s,n=e.mouseEventsExtra;if(!1!==n._state.moved||n._state.longClick&&!n._mobileDevice)this.selectedId=null;else{let t=e.mouseEvents.picker.selectedId;void 0===t&&(t="n"+e.mouseEvents.Selector.preciseId),"number"===typeof t&&(t=`n${t}`);let n=this.getRootNode();i=n.id;let o=this.WbWorld.instance.nodes.get(t),a=o;console.log(o,t);while(o.parent)a=o,o=this.WbWorld.instance.nodes.get(o.parent);s=a.id,console.log(o),o.id===i?(this.selectedId=t,Object.values(this.instances).map(((e,t)=>{e.rootNodeId===s&&(this.selectedInstance=Object.keys(this.instances)[t])}))):this.selectedId=null}}}})),a()(this,"resizeGarden",(e=>{let t=this.instances[e],i=t.rootNodeId;const s=this.WbWorld.instance.nodes.get(i);let n={id:i,translation:`${t.y/1e3},${t.x/1e3},0.00`},o=this.webotsView,a=this.WbWorld;o._view.animation._view.x3dScene._applyPoseToObject(n,s),n={id:i,scale:"1,1,1"},o._view.animation._view.x3dScene._applyPoseToObject(n,s);let l=s.children[1].children[0],r=`${t.botWidth/1e3},${t.botLength/1e3}`.replace(/,/g," ").split(/\s/).filter((e=>e));r=r.map((e=>parseFloat(e)));let c=l.children[0].geometry;c.size=new a.instance.viewpoint.WbVector2(r[0],r[1]),c.updateSize(),console.log(`resizing ${c.id} to ${r} for ${t.rootNodeId}`,s),n={id:s.children[0].id,scale:"0,0,0.00"},o._view.animation._view.x3dScene._applyPoseToObject(n,s.children[0].id),o._view.animation._view.x3dScene._applyPoseToObject(n,s.children[0]),o._view.animation._view.x3dScene.render(),console.log(a.instance.sceneTree)})),a()(this,"createSoil",(e=>{this.addSelector();let t=this.instances[e];const i=document.getElementsByTagName("webots-view")[0];this.webotsView=i;const s=i._view.animation._view.x3dScene.WbWorld;this.WbWorld=s;let n=this.getRootNode(),o=n.children[0],a=(o.id,""),l=o.clone();a=l.id,t.rootNodeId=a,l.parent=n.id,s.instance.nodes.set(a,l),n.children.push(l),l.finalize(),this.resizeGarden(e)})),a()(this,"applyInstance",(e=>{this.instances[e];this.resizeGarden(e),this.createSoilBed(e),this.createTransforms(e),this.createLegs(e),this.createConcrete(e),this.placeRobotZLocation(e),this.resizeRobot(e),this.moveBot(e,!0),this.positionPlants(e);window.self=this})),a()(this,"destroyInstance",(e=>{this.selectedInstance=null;let t=this.instances[e],i=t.rootNodeId;const s=this.WbWorld.instance.nodes.get(i);s.delete(),this.webotsView._view.animation._view.x3dScene.render(),delete this.instances[e]})),a()(this,"deleteAllInstances",(()=>{Object.keys(this.instances).map((e=>this.destroyInstance(e)))})),a()(this,"createGardenSoil",(e=>{})),a()(this,"getDescendantNode",((e,t)=>{let i=e;return t.map((e=>i=i.children[e])),i})),a()(this,"applyTransformation",((e,t,i)=>{"string"!==typeof i&&(i=i.join(","));let s={id:e.id,[t]:i};this.webotsView._view.x3dScene._applyPoseToObject(s,e)})),a()(this,"createLegs",(e=>{let t=this.instances[e];if("Wooden"!==t.bedType||!t.raised)return;let{webotsView:i,WbWorld:s}=this,n=this.getSoilTransform(e),o=n.children[0].children[0],a=o.clone(),l=o.clone(),r=o.clone(),c=o.clone(),m=o.clone(),h=o.clone(),d=t.legs.width/1e3,p=2*(25-t.plankThickness)/1e3,u=[a,l,r,c,m,h],b=[[d,d,t.raisedHeight/1e3],[t.botWidth/1e3-2*d+p,d,d]],_=[0,1,0,0,1,0],y=t.botWidth,g=t.botLength,v=t.raisedHeight/1e3/2,x=[`${-y/1e3/2+d/2-p/2},${-g/1e3/2+d/2},0`,`0,${-g/1e3/2+d/2},${-v/2}`,`${y/1e3/2-d/2+p/2},${-g/1e3/2+d/2},0`,`${-y/1e3/2+d/2-p/2},${g/1e3/2-d/2},0`,`0,${g/1e3/2-d/2},${-v/2}`,`${y/1e3/2-d/2+p/2},${g/1e3/2-d/2},0`];u.map(((e,t)=>{e.parent=n.children[2].id,s.instance.nodes.set(e.id,e),n.children[2].children.push(e),e.finalize();let o={id:e.id,scale:b[_[t]].join(",")};i._view.x3dScene._applyPoseToObject(o,e),o={id:e.id,translation:x[t]},i._view.x3dScene._applyPoseToObject(o,e)}));{let e={id:n.children[2].id,translation:`0,0,${v}`};i._view.x3dScene._applyPoseToObject(e,n.children[2])}i._view.animation._view.x3dScene.render()})),a()(this,"createConcrete",(e=>{let t=this.instances[e];if("Concrete"!==t.bedType)return;let{webotsView:i,WbWorld:s}=this,n=this.getSoilTransform(e);{let e=n.children[0].children[0],t={id:e.id,scale:"0,0,0"};i._view.x3dScene._applyPoseToObject(t,e)}let o=t.botLength/1e3,a=o+1,l=t.botLength/1e3/o,r=[-t.botWidth/1e3/2,t.botWidth/1e3/2],c=n.children[0].children[1],m=n.children[0].children[2];for(let d=0;d<a;){let e=d*l-t.botLength/1e3/2;for(let t=0;t<2;t++){let o=[r[t],e,.01],a=c.clone();a.parent=n.children[3].id,s.instance.nodes.set(a.id,a),n.children[3].children.push(a),a.finalize();let l={id:a.id,translation:o.join(",")};if(i._view.x3dScene._applyPoseToObject(l,a),l={id:a.id,scale:[1,1,1].join(",")},i._view.x3dScene._applyPoseToObject(l,a),1==t){let o=[0,0,1,3.142];l={id:a.id,rotation:o.join(",")},i._view.x3dScene._applyPoseToObject(l,a);let c=m.clone();c.parent=n.children[3].id,s.instance.nodes.set(c.id,c),n.children[3].children.push(c),c.finalize(),console.log("DRAGCHAIN:",c),o=[r[t]+.008,e,.251],l={id:c.id,translation:o.join(",")},i._view.x3dScene._applyPoseToObject(l,c)}else{let e=[0,0,1,0];l={id:a.id,rotation:e.join(",")},i._view.x3dScene._applyPoseToObject(l,a)}}d++}let h=n.children[0].children[3];{let e=t.botLength,o=[[r[0]-.015,-e/1e3/2,.37],[r[1]+.015,-e/1e3/2,.37]];o.map((t=>{let o=h.clone();o.parent=n.children[3].id,s.instance.nodes.set(o.id,o),n.children[3].children.push(o),o.finalize();let a=[1,1,e/1500],l={id:o.id,scale:a.join(",")};i._view.x3dScene._applyPoseToObject(l,o),l={id:o.id,translation:t.join(",")},i._view.x3dScene._applyPoseToObject(l,o)}))}n.children[3];{let e={id:n.children[3].id,translation:[0,0,-.05].join(",")};i._view.x3dScene._applyPoseToObject(e,n.children[3])}i._view.animation._view.x3dScene.render()})),a()(this,"createTransforms",(e=>{let t=this.getSoilTransform(e),i=t.children[1],s=6;Array.from(t.children).slice(2).map(((e,t)=>{const i=this.WbWorld.instance.nodes.get(e.id);try{i.delete()}catch(s){}})),t.children=t.children.filter(((e,t)=>parseInt(t)<2));while(Array.from(t.children).length<s){let e=i.clone();e.parent=t.id,Array.from(e.children.slice(0)).map(((e,t)=>{const i=this.WbWorld.instance.nodes.get(e.id);i.delete()})),e.children=e.children.filter(((e,t)=>parseInt(t)<0)),this.WbWorld.instance.nodes.set(e.id,e),t.children.push(e),console.log(e.children.length,e,i,t),e.finalize()}})),a()(this,"getSoilTransform",(e=>{let t=this.instances[e],i=t.rootNodeId;return this.WbWorld.instance.nodes.get(i)})),a()(this,"createSoilBed",(e=>{let t=this.instances[e],i=t.bedType,s=(t.x,t.y,t.botWidth),n=t.botLength;const o=document.getElementsByTagName("webots-view")[0];this.webotsView=o;const a=o._view.animation._view.x3dScene.WbWorld;this.WbWorld=a;let l=t.rootNodeId;const r=this.WbWorld.instance.nodes.get(l);let c=r.children[1].children[0],m=c.id;switch(Array.from(r.children[1].children.slice(2)).map(((e,t)=>{const i=this.WbWorld.instance.nodes.get(e.id);i.delete()})),r.children[1].children=r.children[1].children.filter(((e,t)=>parseInt(t)<2)),i){case"Wooden":{let e=r.children[0].children[0];{let e=r.children[0].children[0],t={id:e.id,scale:"0,0,0"};o._view.x3dScene._applyPoseToObject(t,e)}let i,l,h=e.clone(),d=e.clone(),p=e.clone(),u=e.clone(),b=2*(25-t.plankThickness)/1e3,_=t.plankThickness/1e3,y=t.soilDepth/1e3;if(t.raised?(i=1.25*y,l=y,y*=2.25):(i=y,l=0,y*=2),t.raised){let i=e.clone();i.parent=r.children[1].id,a.instance.nodes.set(i.id,i),r.children[1].children.push(i),i.finalize();let c={id:i.id,scale:`${s/1e3+b},${n/1e3},${_}`};o._view.x3dScene._applyPoseToObject(c,i),c={id:i.id,translation:`0,0,${l}`},o._view.x3dScene._applyPoseToObject(c,i);let m=t.raisedHeight/1e3-(l-_/2);c={id:r.children[1].id,translation:`0,0,${m}`},o._view.x3dScene._applyPoseToObject(c,r.children[1])}else{let e=0,t={id:r.children[1].id,translation:`0,0,${e}`};o._view.x3dScene._applyPoseToObject(t,r.children[1])}let g={id:m,translation:`0,0,${i}`};o._view.x3dScene._applyPoseToObject(g,c);let v=[h,d,p,u],x=[`${s/1e3+2*_+b},${_},${y}`,`${_},${n/1e3},${y}`],f=[`0,${-n/1e3/2-_/2},${y/2}`,`0,${n/1e3/2+_/2},${y/2}`,`${-s/1e3/2-_/2-b/2},0,${y/2}`,`${s/1e3/2+_/2+b/2},0,${y/2}`];v.map(((e,t)=>{e.parent=r.children[1].id,a.instance.nodes.set(e.id,e),r.children[1].children.push(e),e.finalize();let i={id:e.id,scale:x[parseInt(t/2)]};o._view.x3dScene._applyPoseToObject(i,e),i={id:e.id,translation:f[t]},o._view.x3dScene._applyPoseToObject(i,e)})),o._view.animation._view.x3dScene.render();let w=-.08,B=.01;{let e=t.botLength/1e3,i=e+1,s=t.botLength/1e3/e,n=[-t.botWidth/1e3/2-b/2,t.botWidth/1e3/2+b/2],l=r.children[0].children[1],c=r.children[0].children[2];for(let m=0;m<i;){let e=m*s-t.botLength/1e3/2;for(let t=0;t<2;t++){let i=[n[t]+(0==t?1:-1)*B,e,.01+w],s=l.clone(),m=a.instance.nodes.get(s.children[0].id);m.delete(),s.children=[s.children[1]],s.parent=r.children[1].id,a.instance.nodes.set(s.id,s),r.children[1].children.push(s),s.finalize();let h={id:s.id,translation:i.join(",")};if(o._view.x3dScene._applyPoseToObject(h,s),h={id:s.id,scale:[1,1,1].join(",")},o._view.x3dScene._applyPoseToObject(h,s),1==t){let i=[0,0,1,3.142];h={id:s.id,rotation:i.join(",")},o._view.x3dScene._applyPoseToObject(h,s);let l=c.clone();l.parent=r.children[1].id,a.instance.nodes.set(l.id,l),r.children[1].children.push(l),l.finalize(),console.log("DRAGCHAIN_s:",l),i=[n[t]+.008-B,e,.251+w],h={id:l.id,translation:i.join(",")},o._view.x3dScene._applyPoseToObject(h,l)}else{let e=[0,0,1,0];h={id:s.id,rotation:e.join(",")},o._view.x3dScene._applyPoseToObject(h,s)}}m++}}{let e=r.children[0].children[3],i=t.botLength,s=[-t.botWidth/1e3/2,t.botWidth/1e3/2],n=[[s[0]-.015+B-b/2,-i/1e3/2,.37+w],[s[1]+.015-B+b/2,-i/1e3/2,.37+w]];n.map((t=>{let s=e.clone();s.parent=r.children[1].id,a.instance.nodes.set(s.id,s),r.children[1].children.push(s),s.finalize();let n=[1,1,i/1500],l={id:s.id,scale:n.join(",")};o._view.x3dScene._applyPoseToObject(l,s),l={id:s.id,translation:t.join(",")},o._view.x3dScene._applyPoseToObject(l,s)}))}}break;case"Concrete":let e=0,i={id:r.children[1].id,translation:`0,0,${e}`};o._view.x3dScene._applyPoseToObject(i,r.children[1]);let l={id:m,translation:"0,0,0.0001"};o._view.x3dScene._applyPoseToObject(l,c);break}})),a()(this,"initBot",((e,t)=>{let i=this.instances[e];this.applyInstance(e),i.botContoller&&i.botContoller.destroy(),i.botContoller=new A(this,t,e)})),a()(this,"processPoints",((e,t)=>{let i=this.instances[t];void 0===i.plants&&(i.plants={});for(let n in i.plants)i.plants[n]["deleted"]=!0;e.map((e=>{i.plants[e.id]=i.plants[e.id]||{},i.plants[e.id]["plantData"]=e,i.plants[e.id]["deleted"]=!1}));let s={botWidth:i.botWidth,botLength:i.botLength,date:(new Date).toISOString()};q.place(this,s,t),this.positionPlants(t)})),a()(this,"positionPlants",(e=>{q.positionPlants(this,e)})),a()(this,"moveRelative",((e,t)=>{let i=this.instances[t];console.log("relative",e,typeof e),console.log(e);try{e=JSON.parse(e)}catch(s){}try{e.x*=1e3,e.y*=1e3,e.z*=1e3,e.x+=i.location.x,e.y+=i.location.y,e.z+=i.location.z}catch(s){}})),a()(this,"publishLogs",((e,t,i)=>{let s=this.instances[i],n={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving ${t?"relative":""} to (${e.x},${e.y},${e.z})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:s.location.x,y:s.location.y,z:s.location.z};s.botContoller.publishGeneralData(n,"logs")})),a()(this,"moveAbsolute",((e,t)=>{try{e=JSON.parse(e)}catch(i){}try{e.x*=1e3,e.y*=1e3,e.z*=1e3}catch(i){}this.moveBot(t,!1,e,"absolute")})),a()(this,"showPlants",((e,t)=>{})),a()(this,"hidePlants",(e=>{})),a()(this,"reallyShowPlants",(e=>{})),this.selectedInstance=null,this.state=I}destroyInitHandler(){}initInstance(e,t){this.startedSelector=!1,this.vueObj=e,this.hadstarted||(window.onload=this.initHandler)}createInstance(){let e=(new Date).getTime();this.selectedInstance=e,this.instances[e]={application:null,showPlants:!1,bed:!1,raised:!0,raisedHeight:750,plantHeight:500,plantHeightLimits:[500,1e3],movingRequestId:0,workSpaceLength:19e3,workSpaceWidth:4e3,botLength:18e3,botWidth:3e3,soilDepth:100,plankThickness:18,legs:{width:100,length:100},location:{x:0,y:0,z:0},initialCamRadius:400,botType:null,botTypeType:null,enableExternalControls:!1,joystick:{x:0,y:0,z:0,speed:{}},topofBed:0,x:0,y:0,reallyShowPlants:()=>{this.reallyShowPlants(e)}};let t=Math.floor(1e3*(2*Math.random()-1)),i=Math.floor(1e3*(2*Math.random()-1)),s=19e3,n=4e3,o=t-s/2,a=i-n/2,l=o+s,r=a+n,c=e=>Math.abs(e.x-t)<e.workSpaceWidth/2+n/2,m=e=>Math.abs(e.y-i)<e.workSpaceLength/2+s/2,h=e=>c(e)&&m(e),d=t>=0?1:-1,p=i>=0?1:-1,u=0;return Object.values(this.instances).slice(0,-1).map(((e,b)=>{let _=e["x"],y=e["y"],g=e["workSpaceWidth"],v=e["workSpaceLength"],x=_-v/2,f=y+g/2,w=x+v,B=f-g,S={startXI:x,startYI:f,stopXI:w,stopYI:B,x:_,y:y,workSpaceWidth:g,workSpaceLength:v};if(h(S)){while(h(S))t+=d,i+=p,o=t-s/2,a=i+n/2,l=o+s,r=a-n;console.table({xes:Math.abs(_-t),compareX:g,yes:Math.abs(y-i),comparey:v,xInt:c(S),yInt:m(S),x:t,xI:_,y:i,yI:y,num:u++})}else console.table({Zero:!0,xes:Math.abs(_-t),compareX:g,yes:Math.abs(y-i),comparey:v,xInt:c(S),yInt:m(S),x:t,xI:_,y:i,yI:y,num:u++})})),this.instances[e].x=t,this.instances[e].y=i,this.createSoil(e),this.numInstances++,e}}const W=new Y},"60a8":function(e){e.exports=JSON.parse('{"FarmBot":{"comments":"applications should be in lowercase","applications":["agriculture"],"bots":{"Genesis":{"Length":3000,"Width":1500,"Plant Height":500,"bedTypes":["W","C"],"canRaise":true},"Genesis XL":{"Length":6000,"Width":3000,"Plant Height":500,"bedTypes":["W","C"],"canRaise":true},"Genesis MAX":{"Length":18000,"Width":3000,"Plant Height":500,"bedTypes":["W","C"],"canRaise":false},"Express":{"Length":3000,"Width":1200,"Plant Height":500,"bedTypes":["W","C"],"canRaise":true},"Express XL":{"Length":6000,"Width":2400,"Plant Height":500,"bedTypes":["W","C"],"canRaise":true},"Express MAX":{"Length":18000,"Width":2400,"Plant Height":500,"bedTypes":["W","C"],"canRaise":false}}},"BrianMechanism":{"applications":["agriculture","construction"],"bots":{"Ground Cable":[],"Aerial Cable":[],"Ground Rail":[],"Aerial Rail":[]}}}')},"634c":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{ref:"botsElement",staticClass:"padding bg-grey-1 full-height noOverflow"},[i("div",{staticClass:"webots-view-container"},[i("webots-view",{staticClass:" webots-view",attrs:{"data-thumbnail":"/robots/"+e.world+"/"+e.world+".jpg","data-scene":"/robots/"+e.world+"/"+e.world+".x3d","data-animation":"/robots/"+e.world+"/"+e.world+".json"}})],1),i("q-page-sticky",{attrs:{position:"bottom-left",offset:[18,18]}},[null!==e.angelBot.selectedInstance?i("instanceEditBtn",{attrs:{angelBot:e.angelBot,instanceNumber:e.selectedInstance,parent:e.parent}}):e._e()],1),i("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[i("q-btn",{style:"z-index:1000",attrs:{fab:"",icon:"add",color:"primary",disable:e.disableMoreScreens},on:{click:function(t){return e.createInstance()}}})],1),e.sideBarOpen?i("simulatorSideBar",{attrs:{angelBot:e.angelBot,stateController:e.angelBot.state,parent:e.parent,instanceNumber:e.angelBot.selectedInstance}}):e._e()],1)},n=[],o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"absolute-bottom"},[i("q-btn",{attrs:{round:"",size:"sm",icon:"settings",color:"primary"},on:{click:e.openSideBar}})],1)])},a=[],l=i("5d57"),r={name:"instanceEditBtn",components:{},props:["angelBot","instanceNumber","parent"],data(){return{}},async created(){},methods:{openSideBar(){this.parent.openSideBar(this.instanceNumber)}},computed:{},watch:{}},c=r,m=i("2877"),h=i("9c40"),d=i("eebe"),p=i.n(d),u=Object(m["a"])(c,o,a,!1,null,null,null),b=u.exports;p()(u,"components",{QBtn:h["a"]});var _=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-drawer",{staticClass:"bg-primary",staticStyle:{"overflow-y":"scroll"},attrs:{bordered:"",side:"right",width:e.rightSideBarSize,overlay:"",breakpoint:2,behavior:"desktop"},model:{value:e.rightSidebarOpen,callback:function(t){e.rightSidebarOpen=t},expression:"rightSidebarOpen"}},[i("q-toolbar",{staticClass:"bg-primary text-white",staticStyle:{height:"10%"}},[i("q-toolbar-title",{staticClass:"q-mt-md q-ml-md"},[i("span",{staticClass:"text-weight-bold q-pt-lg"},[e._v("Farmbot Simulator")]),i("br"),i("span",{staticClass:"text-caption",staticStyle:{"font-size":"0.8em"}},[e._v("Instance Settings")])]),i("q-btn",{attrs:{fab:"",dense:"",icon:"done",color:"primary",label:"Apply"},on:{click:function(t){e.angelBot.applyInstance(e.instanceNumber),e.closeSelf()}}}),i("q-btn",{attrs:{fab:"",dense:"",icon:"delete",color:"red",label:"Destroy Farm"},on:{click:function(t){e.angelBot.destroyInstance(e.instanceNumber),e.closeSelf()}}}),i("q-btn",{attrs:{fab:"",dense:"",icon:"delete",color:"red",label:"Destroy All Farms"},on:{click:function(t){e.angelBot.deleteAllInstances(),e.closeSelf()}}}),i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:e.closeSelf}})],1),i("q-splitter",{staticClass:"absolute full-width bg-grey-1",staticStyle:{height:"90%"},attrs:{limits:[0,1/0]},scopedSlots:e._u([{key:"before",fn:function(){return[i("div",{staticClass:"q-pa-sm"},[i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Application",caption:"The area where the robot is to be employed"},on:{show:function(t){return e.showText("application")}}},[i("div",{staticClass:"q-pa-md"},[i("q-select",{attrs:{filled:"",label:"Application",options:Object.keys(e.angelBot.applications())},on:{input:e.updateApplication},model:{value:e.angelBot.instances[e.instanceNumber].application,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"application",t)},expression:"angelBot.instances[instanceNumber].application"}}),"Agriculture"===e.angelBot.instances[e.instanceNumber].application?i("div",[i("q-input",{attrs:{type:"number",label:"Garden Position X(mm)"},on:{input:e.updateX},model:{value:e.angelBot.instances[e.instanceNumber].x,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"x",t)},expression:"angelBot.instances[instanceNumber].x"}}),i("q-input",{attrs:{type:"number",label:"Garden Position Y(mm)"},on:{input:e.updateY},model:{value:e.angelBot.instances[e.instanceNumber].y,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"y",t)},expression:"angelBot.instances[instanceNumber].y"}}),i("q-input",{attrs:{type:"number",label:"Garden Length(mm)"},on:{input:function(t){return e.angelBot.resizeGarden(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].botLength,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botLength",t)},expression:"angelBot.instances[instanceNumber].botLength"}}),i("q-input",{attrs:{type:"number",label:"Garden Width(mm)"},on:{input:function(t){return e.angelBot.resizeGarden(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].botWidth,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botWidth",t)},expression:"angelBot.instances[instanceNumber].botWidth"}}),i("q-input",{attrs:{type:"number",label:"Plant Height(mm) "+e.angelBot.instances[e.instanceNumber].plantHeightLimits[0]+"-"+e.angelBot.instances[e.instanceNumber].plantHeightLimits[1]},on:{input:e.changePlantHeight},model:{value:e.plantHeight,callback:function(t){e.plantHeight=t},expression:"plantHeight"}}),e.hasNoBed?e._e():i("q-select",{attrs:{filled:"",options:e.bedTypes,label:"Bed Type"},on:{input:e.changeBedType},model:{value:e.angelBot.instances[e.instanceNumber].bedType,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"bedType",t)},expression:"angelBot.instances[instanceNumber].bedType"}}),e.canRaiseBed&&"Wooden"===e.angelBot.instances[e.instanceNumber].bedType?i("div",[i("q-checkbox",{attrs:{label:"Raised Bed?",disable:!e.canRaiseBed},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].raised,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"raised",t)},expression:"angelBot.instances[instanceNumber].raised"}}),e.angelBot.instances[e.instanceNumber].raised?i("q-input",{attrs:{type:"number",label:"Bed Height(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].raisedHeight,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"raisedHeight",t)},expression:"angelBot.instances[instanceNumber].raisedHeight"}}):e._e()],1):e._e(),i("q-checkbox",{attrs:{label:"Show plants"},on:{input:e.startShowingPlants},model:{value:e.showPlants,callback:function(t){e.showPlants=t},expression:"showPlants"}})],1):e._e()],1)]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Bot Type",caption:"The Type of Robot"},on:{show:function(t){return e.showText("botType")}}},[i("div",{staticClass:"q-pa-md"},[i("q-select",{attrs:{filled:"",options:e.botTypes,label:"Bot Type"},on:{input:e.updateBotType},model:{value:e.angelBot.instances[e.instanceNumber].botType,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botType",t)},expression:"angelBot.instances[instanceNumber].botType"}}),e.angelBot.instances[e.instanceNumber].botType?i("q-select",{attrs:{filled:"",options:e.botTypesTypes,label:"Bot Model"},on:{input:e.changeBotType},model:{value:e.angelBot.instances[e.instanceNumber].botTypeType,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botTypeType",t)},expression:"angelBot.instances[instanceNumber].botTypeType"}}):e._e(),"FarmBot"!==e.angelBot.instances[e.instanceNumber].botType?i("q-input",{attrs:{type:"number",label:"Bot Length(mm)"},model:{value:e.angelBot.instances[e.instanceNumber].botLength,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botLength",t)},expression:"angelBot.instances[instanceNumber].botLength"}}):e._e(),"FarmBot"!==e.angelBot.instances[e.instanceNumber].botType?i("q-input",{attrs:{type:"number",label:"Bot Width(mm)"},model:{value:e.angelBot.instances[e.instanceNumber].botWidth,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botWidth",t)},expression:"angelBot.instances[instanceNumber].botWidth"}}):e._e()],1)]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"WebApp",caption:"Log in to Web App to Control your robot from there."}},[i("div",{staticClass:"q-pa-md"},[i("q-form",{staticClass:"text-white",on:{submit:e.onSubmit,reset:e.onReset}},[i("q-input",{attrs:{label:"Email",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),i("q-input",{attrs:{label:"Password",type:"password",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":e.passwordErrorMessage},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),i("div",{staticClass:"q-pa-md"},[i("q-btn",{attrs:{label:"Submit",type:"submit",color:"primary"}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"white",flat:""}})],1)],1)],1)])],1)]},proxy:!0},{key:"after",fn:function(){return[i("div",{staticClass:"q-pa-md"},[i("texts",{attrs:{selectedSectionText:e.selectedSectionText}})],1)]},proxy:!0}]),model:{value:e.splitterModel,callback:function(t){e.splitterModel=t},expression:"splitterModel"}}),i("div")],1)},y=[],g=(i("ddb0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("q-tabs",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab",{attrs:{name:"info",label:"Info"}}),i("q-tab",{attrs:{name:"controls",label:"Controls"}})],1),i("q-tab-panels",{staticClass:"bg-grey-1 q-ma-none full-width q-pa-none",attrs:{animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab-panel",{attrs:{name:"controls"}},[i("q-markdown",[e._v("\n### Controls\n\n|Key|Function|\n|---|--------|\n|z| Zoom Out|\n|Z| Zoom In|\n|C \\(c\\)| Zoom to Center|\n|T (t)| Top View|\n|D (d)| Bottom View|\n|L (l)| Left View|\n|R \\(r\\)| Right View|\n|F (f)| Front View|\n|H (g)| Go Home|\n|Backspace| Emergency Stop|\n|Mouse | Rotate|\n|Mouse Wheel | Zoom|\n\n### Gamepad Controls\n|Key|Function|\n|---|--------|\n|Left Stick x| Zoom|\n|Left Stick y| Z-Axis|\n|Right Stick x| X-Axis|\n|Right Stick y| Y-Axis|\n|Left Stick btn| Go Home|\n|Right Stick btn| Emergency Stop|\n|Buttons(4-7) | Speed |\n\n")])],1),i("q-tab-panel",{attrs:{name:"info"}},["Init"===e.selectedSectionText?i("div",[i("p",{staticClass:"text-subtitle1"},[e._v("Use these settings to set up your simulation. ")]),i("p",[e._v("We have only two types of robots from which you will be able to select. But they can work in a wide range of fields: ")]),i("p",[e._v("1: Farmbot from Farmbot Inc")]),i("p",[e._v("2: Our own AngelBot - the master of cables, rails and prices.")]),i("p",[e._v("AngelBot is so simple you can fabricate it yourself, and so cheap you can afford an army of them. It is designed to be affordable.")]),i("p",{staticClass:"text-subtitle1 underline"},[e._v("You can use this simulator to:")]),i("p",[e._v("1. Test how either of the robots works in any field that is relevant to it.")]),i("p",[e._v("2. Test control code (or sequences) before deploying to the real robot. The advantages of this are manifold.")]),i("p",[e._v("3. Test control code even if you do not have a physical robot.")]),i("p",[e._v("4. Teach programming. This simulator will provide a means of letting the children see the result of the code the develop (to control the robots)")]),i("p",[e._v("5. Control the robot without the webApp")]),i("p",[e._v("6. Compare different features of these two robots")]),i("p",[e._v("6. Compare different features of these two robots")])]):"application"===e.selectedSectionText?i("div",[i("p",[e._v("Select the area in which you'd like to use the robot.")]),i("p",[e._v("The list provides but a simple subset of the areas in which the robots can be used. How else can they be used? - This is left to the imagination of the creative mind.")]),i("p",[e._v("We will keep addition more applications to the list as soon as they have been implemented")])]):"botType"===e.selectedSectionText?i("div",{staticClass:"q-ma-none"},[i("p",[e._v("Select the type of Robot which you'd like to simulate.")]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Farmbot"}},[i("q-markdown",[e._v("\n### Genesis (Regular)\n|||\n|--|---|\n|Length |3000mm|\n|Width|1500mm|\n|Height|500mm|\n\n### Genesis xl\n|||\n|--|---|\n|Length |6000mm|\n|Width|3000mm|\n|Height|500mm|\n\n### Express (Regular)\n|||\n|--|---|\n|Length |3000mm|\n|Width|1200mm|\n|Height|500mm|\n\n### Express xl\n|||\n|--|---|\n|Length |6000mm|\n|Width|2400mm|\n|Height|500mm|\n\n")])],1),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"AngelBot"}},[i("q-markdown",[e._v("\n1. Ground Cable\nGuided by a cable, but supported by the ground.\n2. Aerial Cable \nGuided by a cable, and supported by the same cable.\n3. Ground Rail \nGuided by a rail on the ground.\n4. Aerial Rail\nGuided by a suspended rail.\n          ")])],1)],1):i("p")])],1)],1)}),v=[],x={name:"texts",props:["selectedSectionText"],created(){},components:{},data(){return{tab:"info"}},methods:{},computed:{}},f=x,w=(i("e89a"),i("429bb")),B=i("7460"),S=i("adad"),T=i("823b"),k=i("3b73"),P=Object(m["a"])(f,g,v,!1,null,null,null),I=P.exports;p()(P,"components",{QTabs:w["a"],QTab:B["a"],QTabPanels:S["a"],QTabPanel:T["a"],QExpansionItem:k["a"]});var M=i("1712"),O=i("cf57"),L={name:"simulatorSideBar",props:["angelBot","instanceNumber","parent","stateController"],async created(){this.plantHeight=this.angelBot.instances[this.instanceNumber].plantHeight;try{this.updateApplication()}catch(i){}try{this.updateBotType()}catch(i){}try{this.changeBotType()}catch(i){}let[e,t]=await Object(M["to"])(l["auth"].checkTokenAndRefresh());if(e)return this.showPlants=!1,this.$q.notify({type:"You need to log in to farmbot cloud first",message:e});this.init()},components:{texts:I},data(){return{plantHeight:500,hasNoBed:!0,canRaiseBed:!1,bedTypes:[],botTypes:[],botTypesTypes:[],showPlants:!1,rightSidebarOpen:!0,password:"test@cseco.co.ke",email:"test@cseco.co.ke",botType:null,botTypeType:null,selectedApplication:null,splitterModel:50,selectedSectionText:"Init",passwordErrorMessage:""}},methods:{isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},async startShowingPlants(){this.showPlants&&this.reallyShowPlants()},async init(){},async reallyShowPlants(e){if(!e){let[e,t]=await Object(M["to"])(l["auth"].checkTokenAndRefresh());if(e)return this.showPlants=!1,this.$q.notify({type:"You need to log in to farmbot cloud first",message:e})}let t=await this.stateController.farmbotGET("points");this.angelBot.showPlants(t,this.instanceNumber)},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:O["a"],color:"primary"},persistent:!0,ok:!1}),i=setInterval((()=>{!1===this.working&&(clearInterval(i),t.hide())}),500)},async onSubmit(){let e={email:this.email,password:this.password};this.working=!0,this.showCustom();let[t,i]=await Object(M["to"])(l["auth"].logIn(e));if(this.working=!1,t)return this.$q.notify({type:"negative",message:t}),this.password="",void(this.passwordErrorMessage=t||t.error||t.message||"wrong email/password");this.$q.notify({type:"positive",message:"Successful login to farmbot cloud."}),this.angelBot.initBot(this.instanceNumber,{user:e}),this.closeSelf()},onReset(){this.email=null,this.password=null},closeSelf(){this.parent.closeSideBar()},updateX(e){this.$set(this.angelBot.instances[this.instanceNumber],"x",parseFloat(e))},updateY(e){this.$set(this.angelBot.instances[this.instanceNumber],"y",parseFloat(e))},updateApplication(e){e=e||this.angelBot.instances[this.instanceNumber].application,this.$set(this.angelBot.instances[this.instanceNumber],"application",e);let t=[];t[this.instanceNumber]=this.angelBot.instances[this.instanceNumber],this.angelBot.instances=Object.assign({},this.angelBot.instances,t),this.botTypes=Object.keys(this.angelBot.botTypes(this.angelBot.instances[this.instanceNumber].application)),this.botTypes.includes(this.angelBot.instances[this.instanceNumber].botType)||this.$set(this.angelBot.instances[this.instanceNumber],"botType","")},updateBotType(e){e=e||this.angelBot.instances[this.instanceNumber].botType,this.$set(this.angelBot.instances[this.instanceNumber],"botType",e);let t=[];t[this.instanceNumber]=this.angelBot.instances[this.instanceNumber],this.angelBot.instances=Object.assign({},this.angelBot.instances,t),t=this.angelBot.botTypes(this.angelBot.instances[this.instanceNumber].application),this.botTypesTypes=Object.keys(t[e]),this.botTypesTypes.includes(this.angelBot.instances[this.instanceNumber].botTypeType)||this.$set(this.angelBot.instances[this.instanceNumber],"botTypeType","")},showText(e){this.selectedSectionText=e},changeBotType(e){e=e||this.angelBot.instances[this.instanceNumber].botTypeType;let t=this.angelBot.instances[this.instanceNumber],i=this.angelBot.botTypes(t.application)[t.botType][e],s=i["bedTypes"]||[];s=s.map((e=>"W"===e?"Wooden":"Concrete")),this.bedTypes=s,s.length>0?this.hasNoBed=!1:this.hasNoBed=!0,this.canRaiseBed=i["canRaise"]||!1,this.angelBot.changeBotType(this.instanceNumber)},changeBedType(e){e=e||this.angelBot.instances[this.instanceNumber].bedType,"Wooden"!==e&&(this.angelBot.instances[this.instanceNumber].raised=!1)},changePlantHeight(e){let t=this.angelBot.instances[this.instanceNumber].plantHeightLimits;e<t[0]?e=t[0]:e>t[1]&&(e=t[1]),this.plantHeight=parseInt(e),this.angelBot.instances[this.instanceNumber].plantHeight=this.plantHeight}},computed:{rightSideBarSize(){return this.$q.screen.lt.xs||this.$q.screen.lt.sm||this.$q.screen.lt.md?document.getElementsByTagName("body")[0].clientWidth:.75*document.getElementsByTagName("body")[0].clientWidth}}},z=L,N=i("9404"),A=i("65c6"),D=i("6ac5"),C=i("8562"),E=i("ddd8"),q=i("27f9"),Y=i("8f8e"),W=i("0378"),$=Object(m["a"])(z,_,y,!1,null,null,null),R=$.exports;p()($,"components",{QDrawer:N["a"],QToolbar:A["a"],QToolbarTitle:D["a"],QBtn:h["a"],QSplitter:C["a"],QExpansionItem:k["a"],QSelect:E["a"],QInput:q["a"],QCheckbox:Y["a"],QForm:W["a"]});const j=i("5d57"),{angelBot:F}=j;var G={name:"demos",components:{instanceEditBtn:b,simulatorSideBar:R},data(){return{emptyWorld:"farmbotSimulatorEmpty",world:"farmbotSimulator",parent:this,sideBarOpen:!1,instanceNumber:0,selectedInstance:0,angelBot:F,splitterModel:[100,100,100]}},async created(){F.initInstance(this,"botsElement")},methods:{createInstance(){this.angelBot.createInstance(),this.sideBarOpen=!0},openSideBar(e){this.selectedInstance=e,this.sideBarOpen=!1,this.$nextTick((()=>this.sideBarOpen=!0))},closeSideBar(){this.sideBarOpen=!1}},computed:{disableMoreScreens(){return F.numInstances>=40}},watch:{splitterModel:{handler(e){if(F.numInstances<2){if(this.splitterModel.toString()===[100,100,100].toString())return;setTimeout((()=>{this.splitterModel.toString()!==[100,100,100].toString()&&(this.splitterModel=[100,100,100])}),100)}else if(2===F.numInstances){if(100===this.splitterModel[0]&&100===this.splitterModel[2])return;setTimeout((()=>{100===this.splitterModel[0]&&100===this.splitterModel[2]||(this.splitterModel[0]=100),this.splitterModel[2]=100;let e=this.splitterModel[1];this.splitterModel=[100,e,100]}),100)}else if(3===F.numInstances){if(100===this.splitterModel[2])return;setTimeout((()=>{100!==this.splitterModel[2]&&this.splitterModel.splice(2,1,100)}),100)}},deep:!0},"angelBot.numInstances":{handler(e){switch(F.numInstances){case 1:this.splitterModel=[100,100,100];break;case 2:this.splitterModel=[100,50,100];break;case 3:this.splitterModel=[50,this.splitterModel[1],100];break;case 4:this.splitterModel=[this.splitterModel[0],this.splitterModel[1],50];break}},deep:!0}}},V=G,X=(i("1d4c"),i("9989")),H=i("de5e"),Z=Object(m["a"])(V,s,n,!1,null,null,null);t["default"]=Z.exports;p()(Z,"components",{QPage:X["a"],QPageSticky:H["a"],QBtn:h["a"]})},"78a7":function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);i("ddb0"),i("4e82");const o=i("007b").default,a=new(i("faa1").EventEmitter);i("b234");class l extends o{constructor(e,t){super(),n()(this,"moveTimeout",null),n()(this,"axisRefreshTime",10),n()(this,"defaultVelocity",.1),n()(this,"plankThickness",18),n()(this,"vSlot",{length:80,width:80}),n()(this,"gantry",{verticalBarHeight:500}),n()(this,"bearings",{diameter:20}),n()(this,"plateDimensions",{thickness:5,length:300,width:100}),n()(this,"boltData",{M14:{headHeight:8.8,headDiameter:22,bodyDiameter:14}}),n()(this,"axes",{x:null,y:null,z:null}),n()(this,"limits",{x:{min:!1,max:!1},y:{min:!1,max:!1},z:{min:!1,max:!1}}),n()(this,"limitPositions",{x:{min:-1/0,max:1/0},y:{min:-1/0,max:1/0},z:{min:-1/0,max:1/0}}),n()(this,"xMin",null),n()(this,"xMax",null),n()(this,"position",{x:0,y:0,z:0}),n()(this,"plateFraction",.4),n()(this,"meshes",{}),n()(this,"movingX",!1),n()(this,"moveForward",(()=>this.moveRelativeXAxis(10))),n()(this,"moveBack",(()=>this.moveRelativeXAxis(-10))),n()(this,"moveRight",(()=>this.moveRelativeYAxis(10))),n()(this,"moveLeft",(()=>this.moveRelativeYAxis(-10))),n()(this,"moveUp",(()=>this.moveRelativeZAxis(10))),n()(this,"moveDown",(()=>this.moveRelativeZAxis(-10))),n()(this,"moveAbsolute",(e=>{this.moveAbsolute("X",e[0]),this.moveAbsolute("Y",e[1]),this.moveAbsolute("Z",e[2]),console.log("moving absolute",e)})),n()(this,"createGroundLegs",(()=>{let e=this.self,t=new BABYLON.TransformNode,i=new BABYLON.TransformNode,s=new BABYLON.TransformNode;try{for(let t in e.gantryVerticalLegMeshes)e.gantryVerticalLegMeshes[t].dispose()}catch(se){}let n=this.main.checkOnTable(e);n.soilTableLegsHeight;const o=BABYLON.MeshBuilder.CreateBox("verticalLeg1",{height:parseInt(e.plantHeight),width:e.legs.width,depth:e.legs.length});let a=this.main.soilDimensions(e),l=o.getBoundingInfo().boundingBox.minimumWorld.y;o.position.y+=e.topofBed-l;let r=o.clone("verticalLeg2");o.material=e.materials.aluminiumMaterial,o.position.x=-a.width/2+e.legs.width/2+e.legs.width,r.position.x=a.width/2-e.legs.width/2-e.legs.width;let c=a.width-2*e.legs.width,m=BABYLON.MeshBuilder.CreateBox("topBar1",{height:c,width:e.legs.width,depth:e.legs.length});m.rotation.x=Math.PI/2,m.rotation.z=Math.PI/2;let h=o.position.y+parseInt(e.plantHeight)/2+e.legs.width/2;m.position.y=h;let d=BABYLON.Mesh.MergeMeshes([o,r,m]);this.minOffsetYAxis=1.5*e.legs.width,d.parent=i;let p=d.clone(d);p.parent=s,p.material=e.materials.woodMaterial,this.meshes.gantryLeg1=d,this.meshes.gantryLeg2=p;let u=e.botWidth-2*e.legs.width,b=BABYLON.MeshBuilder.CreateBox("horizontalFrameLeg1",{height:c,width:e.legs.width,depth:e.legs.length}),_=BABYLON.MeshBuilder.CreateBox("horizontalFrameLeg2",{height:u,width:e.legs.width,depth:e.legs.length});b.material=e.materials.aluminiumMaterial,b.rotation.z=Math.PI/2,_.rotation.x=Math.PI/2,b.position.y=h+e.legs.width;let y=b.clone("horizontalFrameLeg3");b.position.z+=u/2+e.legs.width/2,y.position.z-=u/2+e.legs.width/2,_.position.y=h+e.legs.width;let g=_.clone("horizontalFrameLeg4");_.position.x+=c/2-e.legs.width/2,g.position.x-=c/2-e.legs.width/2;let v=b.clone("horizontalFrameBeam1"),x=y.clone("horizontalFrameBeam2"),f=e.legs.width+5,w=BABYLON.MeshBuilder.CreateCylinder("topBearing1",{height:f,diameter:e.legs.width}),B=BABYLON.MeshBuilder.CreateCylinder("coiledRope1",{height:f/4,diameter:e.legs.width+f/4*2,arc:.5,enclose:!0});w.material=e.materials.woodMaterial,w.position.y=h,B.material=e.materials.grassMaterial,B.position.y=h;let S=w.clone("topBearing1"),T=B.clone("coiledRope2");B.rotation.y=Math.PI,w.position.x+=c/4,B.position.z+=u/2+e.legs.width/2,S.position.x-=c/4,T.position.z-=u/2+e.legs.width/2;let k=BABYLON.Mesh.MergeMeshes([w,S]),P=BABYLON.Mesh.MergeMeshes([B,T]),I=k.clone("topBearing1B"),M=P.clone("coiledRope1B");k.position.z+=u/2+e.legs.width/2,P.position.x+=c/4,I.position.z-=u/2+e.legs.width/2,M.position.x-=c/4;let O=BABYLON.Mesh.MergeMeshes([k,I]),L=BABYLON.Mesh.MergeMeshes([P,M]);O.parent=t,L.parent=t,this.meshes.topBearing1All=O,this.meshes.coiledRopeAll=L,v.position.y-=f+e.legs.width,x.position.y-=f+e.legs.width;let z=BABYLON.MeshBuilder.CreateCylinder("coiledRope1",{height:u+e.legs.width,diameter:f/4});z.rotation.x=Math.PI/2,z.material=e.materials.grassMaterial,z.position.y=h;let N=f/4;z.position.x=-(c/4+e.legs.width/2+N/2);let A=z.clone("rope2"),D=z.clone("rope3"),C=z.clone("rope4");A.position.x+=e.legs.width+N,D.position.x=c/4+e.legs.width/2+N/2,C.position.x=c/4+e.legs.width/2+N/2-(e.legs.width+N);let E=BABYLON.Mesh.MergeMeshes([z,A,D,C]);E.parent=t,this.meshes.allRopes=E;let q=BABYLON.MeshBuilder.CreateCylinder("hole1",{height:e.legs.width+5,diameter:1.5*N});q.rotation.x=Math.PI/2,q.material=e.materials.blackMaterial,q.position.y=h,q.position.x=A.position.x,q.parent=s;let Y=q.clone("hole2");Y.position.x=z.position.x,Y.parent=i;let W=q.clone("hole3");W.position.x=D.position.x,W.parent=i;let $=q.clone("hole4");$.position.x=C.position.x,$.parent=s,this.meshes.hole1=q,this.meshes.hole2=Y,this.meshes.hole3=W,this.meshes.hole4=$;let R=BABYLON.MeshBuilder.CreateCylinder("knot1",{height:1.5*e.legs.width,diameterBottom:1*N,diameterTop:3*N});R.rotation.x=Math.PI/2;let j=R.clone("knot1A");j.rotation.y=-Math.PI,R.position.z-=e.legs.width/2,j.position.z+=e.legs.width/2,R=BABYLON.Mesh.MergeMeshes([R,j]),R.material=e.materials.sandMaterial,R.position.y=h,R.position.x=A.position.x,R.parent=i;let F=R.clone("knot2");F.position.x=z.position.x,F.parent=s;let G=R.clone("knot3");G.position.x=D.position.x,G.parent=s;let V=R.clone("knot4");V.position.x=C.position.x,V.parent=i,this.meshes.knot1=R,this.meshes.knot2=F,this.meshes.knot3=G,this.meshes.knot4=V,this.xMin=this.minOffsetYAxis+e.legs.width/2,this.xMax=u/2+e.legs.width/2-1.5*e.legs.width,i.position.z=this.xMin,s.position.z=-this.xMin;let X=BABYLON.MeshBuilder.CreateBox("bearingFlange",{height:f,width:e.legs.width,depth:e.legs.length});X.position.y=h;let H=X.clone("bearingFlange2");X.position.z=u/2+e.legs.width/2,X.position.x=c/2-e.legs.width/2,H.position.z=-(u/2+e.legs.width/2),H.position.x=c/2-e.legs.width/2;let Z=X.clone("bearingFlange3"),Q=H.clone("bearingFlange4");Z.position.x=-(c/2-e.legs.width/2),Q.position.x=-(c/2-e.legs.width/2);let J=BABYLON.MeshBuilder.CreateBox("outerLeg1",{height:parseInt(e.plantHeight)-f,width:e.legs.width,depth:e.legs.length});l=J.getBoundingInfo().boundingBox.minimumWorld.y,J.position.y+=e.topofBed-l,J.position.z=u/2+e.legs.width/2,J.position.x=c/2-e.legs.width/2;let U=J.clone("outerLeg1");U.position.z=-(u/2+e.legs.width/2),U.position.x=c/2-e.legs.width/2;let K=J.clone("outerLeg3"),ee=U.clone("outerLeg4");K.position.x=-(c/2-e.legs.width/2),ee.position.x=-(c/2-e.legs.width/2);let te=BABYLON.MeshBuilder.CreateBox("topBarCentral",{height:c,width:e.legs.width,depth:e.legs.length});te.rotation.x=Math.PI/2,te.rotation.z=Math.PI/2,te.position.y=h+e.legs.width;let ie=BABYLON.Mesh.MergeMeshes([b,_,y,g,v,x,X,H,Z,Q,J,U,K,ee,te]);ie.parent=t,this.meshes.topFrame=ie,e.frontLeg=i,e.hindLeg=s,e.platformMain=t})),n()(this,"createLegs",(()=>{try{this.self.botTypeType.match(/ground/i)?this.createGroundLegs():this.createAerialLegs()}catch(e){}})),n()(this,"goHome",(async()=>{const e=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("Z",this.limitPositions.z.max),e(!0)})),t=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("Y",this.limitPositions.y.min),e(!0)})),i=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("X",this.limitPositions.x.min),e(!0)}));await Promise.all([e(),t(),i()])})),n()(this,"emergencyStop",(()=>{a.emit("emergencyStopX"),a.emit("emergencyStopY"),a.emit("emergencyStopZ")})),n()(this,"destroy",(()=>{for(let e in this.meshes)this.meshes[e].dispose();this._destroy()})),this.self=e,this.main=t}create(){this.createGantry()}async createGantry(){if(!this.self.botTypeType)return;this.createLegs();const e=async()=>new Promise((async(e,t)=>{await this.getXAxisLimit("X",1),await this.getXAxisLimit("X",-1),e(!0)}));await Promise.all([e()]),this.self.enableExternalControls=!0}async getXAxisLimit(e,t){return new Promise(((e,i)=>{let s,n,o,l,r=this.self,{frontLeg:c,hindLeg:m,platformMain:h}=r,d="z",p=100,u=!0,b=!1,_=!1;s=this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld[d],n=this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld[d];let y=new BABYLON.Vector3(0,0,t*p),g=new BABYLON.Vector3(0,0,-t*p),v=new BABYLON.Vector3(0,0,1*t);l=i=>{if(!u){b=!1,a.removeListener("axisLimitX",l);let s="min";return 1===t&&(s="max"),this.limitPositions[i.axis.toLowerCase()][s]=h.position[d],e()}u=!1,b=!0},a.on("axisLimitX",l);const x=()=>{o=setTimeout((()=>{if(!u&&!b)return;b?(_||(h.position.addInPlace(g),c.position.addInPlace(g),m.position.addInPlace(g)),_=!0,h.position.addInPlace(v),h.position.addInPlace(v),h.position.addInPlace(v)):(h.position.addInPlace(y),c.position.addInPlace(y),m.position.addInPlace(y)),s=this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld[d],n=this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld[d];let e=r.soil.getBoundingInfo().boundingBox;e=[e.minimumWorld.z,e.maximumWorld.z],1===t&&s>=e[1]&&(y=new BABYLON.Vector3(0,0,-p-(s-e[1])),h.position.addInPlace(y),m.position.addInPlace(y),c.position.addInPlace(y),clearTimeout(o),u=!1,b=!1,a.emit("axisLimitX",{axis:"X",direction:"max"})),-1===t&&n<=e[0]&&(y=new BABYLON.Vector3(0,0,p-(n-e[0])),h.position.addInPlace(y),m.position.addInPlace(y),c.position.addInPlace(y),clearTimeout(o),u=!1,b=!1,a.emit("axisLimitX",{axis:"X",direction:"min"})),(u||b)&&x()}),10)};x()}))}async moveRelativeYAxis(e,t,i){}async moveRelativeXAxis(e,t,i,s){if(this.movingX)return!1;if(this.movingX=!0,0===Math.abs(e))return;let n,o,l,r=this.self,{frontLeg:c,hindLeg:m,platformMain:h}=r,d="z",p=h.position[d],u=(this.limitPositions.x.min,p-this.limitPositions.x.min),b=this.xMax-this.xMin,_=this.axisRefreshTime;return i||(i=t?e/t:this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,o=n/100*_,l=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let r,y,g,v;const x=()=>e(!0);g=e=>{this.movingX=!1,clearTimeout(r),a.removeListener("limitX",g),a.removeListener("stopX",v),x()},v=e=>{this.movingX=!1,clearTimeout(r),a.removeListener("limitX",g),a.removeListener("stopX",v),x()},a.once("limitX",g),a.once("stopX",v);const f=()=>{if(0===l)return a.emit("stopX",!0);p=h.position[d],u=p-this.limitPositions.x.min;let e=b-u%b;o=e,l>o?(t=_,y=o/2):(y=l,t=y/(1e3*i));this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld.y,this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.maximumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.minimumWorld.y,Math.floor(u/b);let n=h.position[d]+s*y;-1===s&&n<this.limitPositions.x.min?(y=Math.abs(h.position[d]-this.limitPositions.x.min),s=1,t=y/(1e3*i)):1===s&&n>this.limitPositions.x.max&&(y=Math.abs(h.position[d]-this.limitPositions.x.max),s=-1,t=y/(1e3*i)),r=setTimeout((()=>{p=h.position[d];let e=p-this.limitPositions.x.min,t=Math.floor(e/b);e>=0&&e<=this.limitPositions.x.max-this.limitPositions.x.min&&(t%2==0?c.position.addInPlace(new BABYLON.Vector3(0,0,2*s*y)):m.position.addInPlace(new BABYLON.Vector3(0,0,2*s*y)),h.position.addInPlace(new BABYLON.Vector3(0,0,s*y))),l-=y,f()}),t)};f()}))}async moveRelativeZAxis(e,t,i){if(0===Math.abs(e))return;let s,n,o,l=this.axisRefreshTime;return t||(t=this.defaultVelocity),i||(i=e/Math.abs(e)||-1),s=1e3*t,n=s/100*l,o=0===e?1/0:Math.abs(e),new Promise(((e,s)=>{let r,c,m,h,d;const p=()=>e(this.axes.z.position.y);h=e=>{clearTimeout(r),a.removeListener("limitZ",h),a.removeListener("stopZ",d),p()},d=e=>{clearTimeout(r),a.removeListener("limitZ",h),a.removeListener("stopZ",d),p()},a.once("limitZ",h),a.once("stopZ",d);const u=()=>{if(o<=0)return a.emit("stopZ",!0);o>n?(c=l,m=n):(m=o,c=m/(1e3*t));let e=this.axes.z.position.y+i*m;-1===i&&e<this.limitPositions.z.min?(m=Math.abs(this.axes.z.position.y-this.limitPositions.z.min),i=1,c=m/(1e3*t)):1===i&&e>this.limitPositions.z.max&&(m=Math.abs(this.axes.z.position.y-this.limitPositions.z.max),i=-1,c=m/(1e3*t)),r=setTimeout((()=>{this.axes.z.position.addInPlace(new BABYLON.Vector3(0,i*m,0)),o-=m,u()}),c)};u()}))}calculateMove(){clearInterval(this.moveTimeout),this.moveTimeout=setInterval((()=>{let e=this.self.joystick.speed||{};e=Object.values(e),e=e.sort(((e,t)=>t-e)).shift(),0===e&&(e=1);let{x:t,y:i,z:s}=this.self.joystick;if(Math.abs(t)+Math.abs(i)+Math.abs(s)===0)return void clearInterval(this.moveTimeout);let n=0,o=0,a=0;Math.abs(i)>0&&(n=i*Math.pow(2,e)),Math.abs(t)>0&&(o=t*Math.pow(2,e)),Math.abs(s)>0&&(a=s*Math.pow(2,e)),this.moveRelativeXAxis(n,100),this.moveRelativeYAxis(o),this.moveRelativeZAxis(a)}),100)}async moveAbsolute(e,t){return new Promise(((i,s)=>{let n,o,l,r,c,m,h,d=!0,p=!1,u=!1,b=100,_=this.self.joystick.speed||{};_=Object.values(_),_=_.sort(((e,t)=>t-e)).shift(),0===_&&(_=1),b=Math.pow(2,_);e.toLowerCase();switch(e){case"Z":case"z":l=this.axes.z,r="y";break;case"Y":case"y":l=this.axes.y,r="x";break;case"X":case"x":l=this.axes.x,r="z";break}let y=(t-l.position[r])/Math.abs(t-l.position[r]);if(n=t=>{clearTimeout(o),d=!1,p=!1,a.removeListener(`axisLimit${e}`,n),a.removeListener(`emergencyStop${e}`,n)},l.position[r]===t)return i();switch(e){case"Z":case"z":l=this.axes.z,r="y",c=new BABYLON.Vector3(0,y*b,0),h=new BABYLON.Vector3(0,-y*b,0),m=new BABYLON.Vector3(0,1*y,0);break;case"Y":case"y":l=this.axes.y,r="x",c=new BABYLON.Vector3(y*b,0,0),h=new BABYLON.Vector3(-y*b,0,0),m=new BABYLON.Vector3(1*y,0,0);break;case"X":case"x":l=this.axes.x,r="z",c=new BABYLON.Vector3(0,0,y*b),h=new BABYLON.Vector3(0,0,-y*b),m=new BABYLON.Vector3(0,0,1*y);break}a.on(`axisLimit${e}`,n),a.once(`emergencyStop${e}`,n);const g=()=>{o=setTimeout((()=>{if(!d&&!p)return;p?(u||l.position.addInPlace(h),u=!0,l.position.addInPlace(m)):l.position.addInPlace(c);let i=l.position[r];switch(e){case"Z":case"z":1===y&&i>=t&&(c=new BABYLON.Vector3(0,-b-(i-t),0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(0,b-(i-t),0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":1===y&&i>=t&&(c=new BABYLON.Vector3(-b-(i-t),0,0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitY",{axis:"Y",direction:"max"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(b-(i-t),0,0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitY",{axis:"Y",direction:"min"}));break;case"X":case"x":1===y&&i>=t&&(c=new BABYLON.Vector3(0,0,-b-(i-t)),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisValue",{axis:"X",direction:"max"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(0,0,b-(i-t)),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisValue",{axis:"X",direction:"min"}));break}(d||p)&&g()}),10)};g()}))}}t["default"]=l},"7db8":function(e,t,i){},"8d5f":function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);const o=i("a41b").default,a=i("78a7").default;class l{constructor(e,t){n()(this,"bot",null),n()(this,"create",(()=>{let e=this.self;if(!e.botType||!e.botTypeType)return;let t=e.botType.toUpperCase();try{this.bot.destroy()}catch(i){}switch(t){case"FARMBOT":this.bot=new o(this.self,this.main);break;case"ANGELBOT":this.bot=new a(this.self,this.main);break}this.bot.create()})),n()(this,"moveAbsolute",((e,t)=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveAbsolute(e,t)})),n()(this,"moveRelative",((e,t)=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveRelative(e,t)})),n()(this,"moveForward",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveForward()})),n()(this,"moveBack",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveBack()})),n()(this,"moveLeft",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveLeft()})),n()(this,"moveRight",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveRight()})),n()(this,"moveUp",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveUp()})),n()(this,"moveDown",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveDown()})),this.self=e,this.main=t}keyboardControlEnabled(){return!!this.self.enableExternalControls}calculateMove(){if(!this.keyboardControlEnabled())return!1;this.bot.calculateMove()}goHome(){if(!this.keyboardControlEnabled())return!1;this.bot.goHome()}emergencyStop(){if(!this.keyboardControlEnabled())return!1;this.bot.emergencyStop()}}t["default"]=l},a41b:function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);i("ddb0"),i("4e82");const o=i("007b").default,a=new(i("faa1").EventEmitter);class l extends o{constructor(e,t){super(),n()(this,"moveTimeout",null),n()(this,"axisRefreshTime",10),n()(this,"defaultVelocity",.1),n()(this,"plankThickness",18),n()(this,"vSlot",{length:80,width:80}),n()(this,"gantry",{verticalBarHeight:500}),n()(this,"bearings",{diameter:20}),n()(this,"plateDimensions",{thickness:5,length:300,width:100}),n()(this,"boltData",{M14:{headHeight:8.8,headDiameter:22,bodyDiameter:14}}),n()(this,"axes",{x:null,y:null,z:null}),n()(this,"limits",{x:{min:!1,max:!1},y:{min:!1,max:!1},z:{min:!1,max:!1}}),n()(this,"limitPositions",{x:{min:-1/0,max:1/0},y:{min:-1/0,max:1/0},z:{min:-1/0,max:1/0}}),n()(this,"position",{x:0,y:0,z:0}),n()(this,"plateFraction",.4),n()(this,"meshes",{}),n()(this,"moveForward",(()=>this.moveRelativeXAxis(10))),n()(this,"moveBack",(()=>this.moveRelativeXAxis(-10))),n()(this,"moveRight",(()=>this.moveRelativeYAxis(10))),n()(this,"moveLeft",(()=>this.moveRelativeYAxis(-10))),n()(this,"moveUp",(()=>this.moveRelativeZAxis(10))),n()(this,"moveDown",(()=>this.moveRelativeZAxis(-10))),n()(this,"reportPosition",(e=>{let t=this.axes.x.position.z-this.limitPositions.x.min,i=this.axes.y.position.x-this.limitPositions.y.min,s=this.limitPositions.z.max-this.axes.z.position.y;e([t,i,s])})),n()(this,"goHome",(async()=>{const e=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("Z",this.limitPositions.z.max),e(!0)})),t=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("Y",this.limitPositions.y.min),e(!0)})),i=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("X",this.limitPositions.x.min),e(!0)}));await Promise.all([e(),t(),i()])})),n()(this,"emergencyStop",(()=>{a.emit("emergencyStopX"),a.emit("emergencyStopY"),a.emit("emergencyStopZ")})),n()(this,"destroy",(()=>{for(let e in this.meshes)this.meshes[e].dispose();this._destroy()})),this.self=e,this.main=t}create(){this.createGantry()}async createGantry(){let e=this.self,t=BABYLON.MeshBuilder.CreateBox("bottomPlate",{height:this.plateDimensions.width,width:this.plateDimensions.length,depth:this.plateDimensions.thickness});t.position.y=this.plateDimensions.width/2,t.rotation.y=Math.PI/2;let i=BABYLON.MeshBuilder.CreateBox("topPlate",{height:this.plateDimensions.width,width:this.plateDimensions.length*this.plateFraction,depth:this.plateDimensions.thickness});i.rotation.y=Math.PI/2,i.position.y=this.plateDimensions.width/2+this.plateDimensions.width;let s=BABYLON.Mesh.MergeMeshes([t,i]);s.material=e.materials.aluminiumMaterial;let n=this.main.soilDimensions(e),o=this.main.checkOnTable(e),a=o.soilHolderHeight,l=e.planks.plank1.position.y+a/2-.5*this.plateDimensions.width+this.bearings.diameter/2;s.position.y=l;let r=s.clone("plate2");s.position.x=-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5,r.position.x=-(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5);let c=BABYLON.MeshBuilder.CreateCylinder("bearing1",{height:this.plankThickness+5,diameter:this.bearings.diameter});c.rotation.z=Math.PI/2,c.position.y=this.bearings.diameter/2;let m=c.clone("bearing2"),h=c.clone("bearing3");h.position.y+=this.plateDimensions.width;let d=h.clone("bearing3");c.position.z=-.8*this.plateDimensions.length*.5,m.position.z=.8*this.plateDimensions.length*.5,h.position.z=-.8*this.plateFraction*this.plateDimensions.length*.5,d.position.z=.8*this.plateFraction*this.plateDimensions.length*.5;let p=BABYLON.Mesh.MergeMeshes([c,m,h,d]),u=e.planks.plank1.position.y+a/2;p.position.y=u,p.material=e.materials.woodMaterial;let b=p.clone("bearings2");p.position.x=-this.plankThickness-n.width/2-(this.plankThickness+5)+this.plankThickness,b.position.x=-(-this.plankThickness-n.width/2-(this.plankThickness+5)+this.plankThickness);let _=BABYLON.Mesh.MergeMeshes([p,b]);this.meshes.allBearings=_;let y=BABYLON.Mesh.MergeMeshes([s,r]);this.meshes.allPlates=y;let g=BABYLON.MeshBuilder.CreateBox("verticalGantryBar1",{height:parseInt(e.plantHeight),width:this.vSlot.length,depth:this.vSlot.width});g.material=e.materials.vSlotSideUpMaterial,g.position.y=parseInt(e.plantHeight)/2,g.rotation.y=Math.PI/2;let v=g.clone("verticalGantryBar2");g.position.x=-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length/2,v.position.x=-(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length/2);let x=2*Math.abs(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length)+2*this.vSlot.length,f=BABYLON.MeshBuilder.CreateBox("horizontalGantryBar",{height:this.vSlot.length,width:this.vSlot.width,depth:x});f.rotation.y=Math.PI/2,f.position.y+=this.vSlot.width/2+parseInt(e.plantHeight);let w=BABYLON.Mesh.MergeMeshes([g,v,f]);this.meshes.gantry=w,w.position.y=e.planks.plank1.position.y+a/2;let B=4*this.vSlot.length,S=BABYLON.MeshBuilder.CreateBox("electricalBox",{height:B,width:2*B/3,depth:B/3});this.meshes.electricalBox=S,S.material=e.materials.electricalBoxMaterial;const T=BABYLON.MeshBuilder.CreatePlane("farmBotLogo",{height:.5*B,width:2*B/3});this.meshes.farmBotLogo=T,T.material=e.materials.logoMaterial,T.position.z-=B/3/2+1;let k=new BABYLON.TransformNode;S.parent=k,T.parent=k,k.rotation.y=-Math.PI/2,k.position.x+=Math.abs(g.position.x)+this.vSlot.width,k.position.y=w.position.y+parseInt(e.plantHeight)/2;let P=400*this.vSlot.width,I=BABYLON.MeshBuilder.CreatePlane("yAxisEndStopLeft",{height:2*this.vSlot.width,width:P});this.meshes.yAxisEndStopLeft=I,I.material=e.materials.aluminiumMaterial,I.material.backFaceCulling=!1,I.checkCollisions=!0,I.position.y=w.position.y+parseInt(e.plantHeight),I.isVisible=!1,I.rotation.x=Math.PI/2;let M=I.clone("yAxisEndStopRight");this.meshes.yAxisEndStopRight=M,I.position.x=g.position.x+1+this.vSlot.width/2-P/2+5,M.position.x=v.position.x-1-this.vSlot.width/2+P/2-5;let O=new BABYLON.TransformNode;w.parent=O,k.parent=O,y.parent=O,_.parent=O,I.parent=O,M.parent=O;let L={height:this.vSlot.width+6*this.bearings.diameter,length:this.vSlot.width+8*this.bearings.diameter},z=BABYLON.MeshBuilder.CreateBox("box",{height:L.height,width:L.length,depth:this.plateDimensions.thickness});this.meshes.crossSlide=z,z.position.y+=L.height/2+w.position.y+parseInt(e.plantHeight)+this.vSlot.width-L.height/2-this.vSlot.width/2,z.position.z+=this.vSlot.width/2+5,z.material=e.materials.aluminiumMaterial;let N=this.vSlot.width+5,A=BABYLON.MeshBuilder.CreateCylinder("bearing1",{height:N,diameter:this.bearings.diameter});A.rotation.x=Math.PI/2,A.position.y+=this.bearings.diameter/2,A.material=e.materials.woodMaterial;let D=A.clone("aBearing2"),C=A.clone("aBearing3"),E=A.clone("aBearing4");A.position.z+=this.vSlot.width,D.position.z+=this.vSlot.width,A.position.x=-(this.bearings.diameter/2+this.vSlot.width/2),D.position.x=this.bearings.diameter/2+this.vSlot.width/2;let q=A.clone("aBearing5"),Y=D.clone("aBearing6");q.position.y+=this.bearings.diameter+this.bearings.diameter+this.vSlot.width+this.bearings.diameter+this.bearings.diameter,Y.position.y=q.position.y,C.position.x+=-(this.bearings.diameter+2*this.bearings.diameter+this.vSlot.width/2),E.position.x+=this.bearings.diameter+2*this.bearings.diameter+this.vSlot.width/2,C.position.y+=2*this.bearings.diameter,E.position.y+=2*this.bearings.diameter;let W=C.clone("aBearing7"),$=E.clone("aBearing8");W.position.y+=this.vSlot.width+this.bearings.diameter/2,$.position.y+=this.vSlot.width+this.bearings.diameter/2;let R=BABYLON.Mesh.MergeMeshes([A,D,C,E,q,Y,W,$]);this.meshes.allABearings=R,R.position.y=z.position.y-this.vSlot.width-this.bearings.diameter/2;let j=new BABYLON.TransformNode;z.parent=j,R.parent=j,j.checkCollisions=!0;let F=parseInt(e.plantHeight)+(L.height-this.vSlot.width)/2+this.vSlot.width,G=BABYLON.MeshBuilder.CreateBox("zAxis",{height:F,width:this.vSlot.length,depth:this.vSlot.width});this.meshes.zAxis=G,G.material=e.materials.vSlotSideMaterial,G.position.y=z.position.y+parseInt(e.plantHeight)/2-L.height,G.position.z=z.position.z+this.plateDimensions.thickness+5+this.vSlot.width/2;let V=BABYLON.MeshBuilder.CreatePlane("zAxisFace1",{height:this.vSlot.width,width:F});this.meshes.zAxisFace1=V,V.material=e.materials.vSlotSideMaterial,V.material.backFaceCulling=!1,V.rotation.z=Math.PI/2,V.position.y=G.position.y;let X=V.clone("zAxisFace2");this.meshes.zAxisFace2=X,V.position.z=G.position.z-this.vSlot.width/2-1,X.position.z=G.position.z+this.vSlot.width/2+1;let H=400*this.vSlot.width,Z=BABYLON.MeshBuilder.CreatePlane("zAxisEndStopTop",{height:H,width:2*this.vSlot.width});this.meshes.zAxisEndStopTop=Z,Z.position.z=G.position.z-this.vSlot.width+1,Z.material=e.materials.aluminiumMaterial,Z.rotation.y=Math.PI/2,Z.checkCollisions=!0,Z.isVisible=!1;let Q=Z.clone("zAxisEndStopBottom");this.meshes.zAxisEndStopBottom=Q,Z.position.y=G.position.y+F/2+H/2-5,Q.position.y=G.position.y-F/2-H/2+5;let J=new BABYLON.TransformNode;G.parent=J,Z.parent=J,Q.parent=J,V.parent=J,X.parent=J,this.axes.z=J;let U=new BABYLON.TransformNode;j.parent=U,J.parent=U,this.axes.y=U;let K=400*this.vSlot.width,ee=BABYLON.MeshBuilder.CreatePlane("xAxisEndStopFront",{height:2*this.vSlot.width,width:K});this.meshes.xAxisEndStopFront=ee,ee.material=e.materials.aluminiumMaterial,ee.checkCollisions=!0,ee.isVisible=!1,ee.position.x=r.position.x,ee.position.y=r.position.y+this.plateDimensions.width/2,ee.rotation.y=Math.PI/2,ee.rotation.x=Math.PI/2;let te=ee.clone("xAxisEndStopBack");this.meshes.xAxisEndStopBack=te,ee.position.z+=n.length/2+K/2-5,te.position.z+=-n.length/2-K/2+5;let ie=new BABYLON.TransformNode;U.parent=ie,O.parent=ie,this.axes.x=ie;const se=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("Z",1),await this.getAxisLimit("Z",-1),e(!0)})),ne=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("Y",1),await this.getAxisLimit("Y",-1),e(!0)})),oe=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("X",1),await this.getAxisLimit("X",-1),e(!0)}));await Promise.all([se(),ne(),oe()]),await this.goHome(),e.enableExternalControls=!0,e.reallyShowPlants()}async getAxisLimit(e,t){return new Promise(((i,s)=>{let n,o,l,r,c,m,h,d,p=!0,u=!1,b=!1,_=100;e.toLowerCase();switch(n=s=>{if(!p){u=!1,a.removeListener(`axisLimit${e}`,n);let o="min";return 1===t&&(o="max"),this.limitPositions[s.axis.toLowerCase()][o]=l.position[r],i()}p=!1,u=!0},e){case"Z":case"z":l=this.axes.z,r="y",t*=-1,c=new BABYLON.Vector3(0,t*_,0),h=new BABYLON.Vector3(0,-t*_,0),m=new BABYLON.Vector3(0,1*t,0);break;case"Y":case"y":l=this.axes.y,r="x",c=new BABYLON.Vector3(t*_,0,0),h=new BABYLON.Vector3(-t*_,0,0),m=new BABYLON.Vector3(1*t,0,0);break;case"X":case"x":l=this.axes.x,r="z",c=new BABYLON.Vector3(0,0,t*_),h=new BABYLON.Vector3(0,0,-t*_),m=new BABYLON.Vector3(0,0,1*t);break}a.on(`axisLimit${e}`,n);const y=()=>{o=setTimeout((()=>{if(!p&&!u)return;let i;switch(u?(b||l.position.addInPlace(h),b=!0,l.position.addInPlace(m)):l.position.addInPlace(c),e){case"Z":case"z":i=this.meshes.zAxis.getBoundingInfo().boundingBox,i=[i.minimumWorld.y,i.maximumWorld.y],d=this.meshes.crossSlide.getBoundingInfo().boundingBox,d=[d.minimumWorld.y,d.maximumWorld.y],1===t&&i[0]>=d[0]&&(c=new BABYLON.Vector3(0,-_-(i[0]-d[0]),0),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===t&&i[1]<=d[1]&&(c=new BABYLON.Vector3(0,_-(i[1]-d[1]),0),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":i=this.meshes.crossSlide.getBoundingInfo().boundingBox,i=[i.minimumWorld.x,i.maximumWorld.x],1===t&&(d=this.meshes.yAxisEndStopRight.getBoundingInfo().boundingBox,d=[d.minimumWorld.x,d.maximumWorld.x],i[1]>=d[0]&&(c=new BABYLON.Vector3(-_-(i[1]-d[0]),0,0),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitY",{axis:"Y",direction:"max"}))),-1===t&&(d=this.meshes.yAxisEndStopLeft.getBoundingInfo().boundingBox,d=[d.minimumWorld.x,d.maximumWorld.x],i[0]<=d[1]&&(c=new BABYLON.Vector3(_-(i[0]-d[1]),0,0),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitY",{axis:"Y",direction:"min"})));break;case"X":case"x":i=this.meshes.allPlates.getBoundingInfo().boundingBox,i=[i.minimumWorld.z,i.maximumWorld.z],1===t&&(d=this.meshes.xAxisEndStopFront.getBoundingInfo().boundingBox,d=[d.minimumWorld.z,d.maximumWorld.z],i[1]>=d[0]&&(c=new BABYLON.Vector3(0,0,-_-(i[1]-d[0])),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitX",{axis:"X",direction:"max"}))),-1===t&&(d=this.meshes.xAxisEndStopBack.getBoundingInfo().boundingBox,d=[d.minimumWorld.z,d.maximumWorld.z],i[0]<=d[1]&&(c=new BABYLON.Vector3(0,0,_-(i[0]-d[1])),l.position.addInPlace(c),clearTimeout(o),p=!1,u=!1,a.emit("axisLimitX",{axis:"X",direction:"min"})));break}(p||u)&&y()}),10)};y()}))}async moveRelativeYAxis(e,t,i,s){if(0===Math.abs(e))return;let n,o,l,r=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,o=n/100*r,l=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let c,m,h,d,p;const u=()=>e(this.axes.y.position.x);d=e=>{clearTimeout(c),1===s?this.limitPositions.y.max=this.axes.y.position.x:this.limitPositions.y.min=this.axes.y.position.x,a.removeListener("limitY",d),a.removeListener("stopY",p),t&&this.reportPosition(t),u()},p=e=>{clearTimeout(c),a.removeListener("limitY",d),a.removeListener("stopY",p),t&&this.reportPosition(t),u()},a.once("limitY",d),a.once("stopY",p);const b=()=>{if(l<=0)return a.emit("stopY",!0);l>o?(m=r,h=o):(h=l,m=h/(1e3*i));let e=this.axes.y.position.x+s*h;-1===s&&e<this.limitPositions.y.min?(h=Math.abs(this.axes.y.position.x-this.limitPositions.y.min),s=1,m=h/(1e3*i)):1===s&&e>this.limitPositions.y.max&&(h=Math.abs(this.axes.y.position.x-this.limitPositions.y.max),m=h/(1e3*i),s=-1),c=setTimeout((()=>{this.axes.y.position.addInPlace(new BABYLON.Vector3(s*h,0,0)),l-=h,b()}),m)};b()}))}async moveRelativeXAxis(e,t,i,s){if(0===Math.abs(e))return;let n,o,l,r=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,o=n/100*r,l=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let c,m,h,d,p;const u=()=>e(this.axes.x.position.z);d=e=>{clearTimeout(c),a.removeListener("limitX",d),a.removeListener("stopX",p),t&&this.reportPosition(t),u()},p=e=>{clearTimeout(c),a.removeListener("limitX",d),a.removeListener("stopX",p),t&&this.reportPosition(t),u()},a.once("limitX",d),a.once("stopX",p);const b=()=>{if(0===l)return a.emit("stopX",!0);l>o?(m=r,h=o):(h=l,m=h/(1e3*i));let e=this.axes.x.position.z+s*h;-1===s&&e<this.limitPositions.x.min?(h=Math.abs(this.axes.x.position.z-this.limitPositions.x.min),s=1,m=h/(1e3*i)):1===s&&e>this.limitPositions.x.max&&(h=Math.abs(this.axes.x.position.z-this.limitPositions.x.max),s=-1,m=h/(1e3*i)),c=setTimeout((()=>{this.axes.x.position.addInPlace(new BABYLON.Vector3(0,0,s*h)),l-=h,b()}),m)};b()}))}async moveRelativeZAxis(e,t,i,s){if(0===Math.abs(e))return;let n,o,l,r=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,o=n/100*r,l=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let c,m,h,d,p;const u=()=>e(this.axes.z.position.y);d=e=>{clearTimeout(c),a.removeListener("limitZ",d),a.removeListener("stopZ",p),t&&this.reportPosition(t),u()},p=e=>{clearTimeout(c),a.removeListener("limitZ",d),a.removeListener("stopZ",p),t&&this.reportPosition(t),u()},a.once("limitZ",d),a.once("stopZ",p);const b=()=>{if(l<=0)return a.emit("stopZ",!0);l>o?(m=r,h=o):(h=l,m=h/(1e3*i));let e=this.axes.z.position.y+s*h;-1===s&&e<this.limitPositions.z.min?(h=Math.abs(this.axes.z.position.y-this.limitPositions.z.min),s=1,m=h/(1e3*i)):1===s&&e>this.limitPositions.z.max&&(h=Math.abs(this.axes.z.position.y-this.limitPositions.z.max),s=-1,m=h/(1e3*i)),c=setTimeout((()=>{this.axes.z.position.addInPlace(new BABYLON.Vector3(0,s*h,0)),l-=h,b()}),m)};b()}))}calculateMove(){clearInterval(this.moveTimeout),this.moveTimeout=setInterval((()=>{let e=this.self.joystick.speed||{};e=Object.values(e),e=e.sort(((e,t)=>t-e)).shift(),0===e&&(e=1);let{x:t,y:i,z:s}=this.self.joystick;if(Math.abs(t)+Math.abs(i)+Math.abs(s)===0)return void clearInterval(this.moveTimeout);let n=0,o=0,a=0;Math.abs(i)>0&&(n=i*Math.pow(2,e)),Math.abs(t)>0&&(o=t*Math.pow(2,e)),Math.abs(s)>0&&(a=s*Math.pow(2,e)),this.moveRelativeXAxis(n),this.moveRelativeYAxis(o),this.moveRelativeZAxis(a)}),10)}async moveAbsolute(e,t){e=[e[1],e[0],e[2]];let i=this.axes.x.position.z-this.limitPositions.x.min,s=this.axes.y.position.x-this.limitPositions.y.min,n=this.limitPositions.z.max-this.axes.z.position.y,o=e[0]-i,a=e[1]-s,l=e[2]-n;this.moveRelative([a,o,-l],t)}async moveRelative(e,t){e=[e[1],e[0],e[2]];let i=this.axes.x.position.z-this.limitPositions.x.min,s=this.axes.y.position.x-this.limitPositions.y.min,n=this.limitPositions.z.max-this.axes.z.position.y,o=this.limitPositions.x.max-this.limitPositions.x.min,a=this.limitPositions.y.max-this.limitPositions.y.min,l=this.limitPositions.z.max-this.limitPositions.z.min,r=e.map((e=>e/Math.abs(e))),c=e[0],m=e[1],h=e[2];r.map(((e,t)=>{switch(t=parseInt(t),t){case 0:1===e?c>o-i&&(c=o-i):Math.abs(c)>i&&(c=-i);break;case 1:1===e?m>a-s&&(m=a-s):Math.abs(m)>s&&(m=-s);break;case 2:-1===e?Math.abs(h)>l-n&&(h=-(l-n)):(console.table({currentZ:n,z:h}),h>n&&(h=n),console.table({currentZ:n,z:h}));break}}));let d=[this.moveRelativeXAxis(c),this.moveRelativeYAxis(m),this.moveRelativeZAxis(h)];await Promise.all(d),t&&this.reportPosition(t)}async moveAbsolute_Old(e,t){return new Promise(((i,s)=>{let n,o,l,r,c,m,h,d=!0,p=!1,u=!1,b=100,_=this.self.joystick.speed||{};_=Object.values(_),_=_.sort(((e,t)=>t-e)).shift(),0===_&&(_=1),b=Math.pow(2,_);e.toLowerCase();switch(e){case"Z":case"z":l=this.axes.z,r="y";break;case"Y":case"y":l=this.axes.y,r="x";break;case"X":case"x":l=this.axes.x,r="z";break}let y=(t-l.position[r])/Math.abs(t-l.position[r]);if(console.log(t),n=t=>{clearTimeout(o),d=!1,p=!1,a.removeListener(`axisLimit${e}`,n),a.removeListener(`emergencyStop${e}`,n)},l.position[r]===t)return i();switch(e){case"Z":case"z":l=this.axes.z,r="y",c=new BABYLON.Vector3(0,y*b,0),h=new BABYLON.Vector3(0,-y*b,0),m=new BABYLON.Vector3(0,1*y,0);break;case"Y":case"y":l=this.axes.y,r="x",c=new BABYLON.Vector3(y*b,0,0),h=new BABYLON.Vector3(-y*b,0,0),m=new BABYLON.Vector3(1*y,0,0);break;case"X":case"x":l=this.axes.x,r="z",c=new BABYLON.Vector3(0,0,y*b),h=new BABYLON.Vector3(0,0,-y*b),m=new BABYLON.Vector3(0,0,1*y);break}a.on(`axisLimit${e}`,n),a.once(`emergencyStop${e}`,n);const g=()=>{o=setTimeout((()=>{if(!d&&!p)return;p?(u||l.position.addInPlace(h),u=!0,l.position.addInPlace(m)):l.position.addInPlace(c);let i=l.position[r];switch(e){case"Z":case"z":1===y&&i>=t&&(c=new BABYLON.Vector3(0,-b-(i-t),0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(0,b-(i-t),0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":1===y&&i>=t&&(c=new BABYLON.Vector3(-b-(i-t),0,0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitY",{axis:"Y",direction:"max"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(b-(i-t),0,0),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisLimitY",{axis:"Y",direction:"min"}));break;case"X":case"x":1===y&&i>=t&&(c=new BABYLON.Vector3(0,0,-b-(i-t)),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisValue",{axis:"X",direction:"max"})),-1===y&&i<=t&&(c=new BABYLON.Vector3(0,0,b-(i-t)),l.position.addInPlace(c),clearTimeout(o),d=!1,p=!1,a.emit("axisValue",{axis:"X",direction:"min"}));break}(d||p)&&g()}),10)};g()}))}}t["default"]=l},e89a:function(e,t,i){"use strict";i("02ed")}}]);